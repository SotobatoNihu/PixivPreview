!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContainerFactory=class{constructor(){this.id="",this.classname="",this.innerHtml="",this.innerText="",this.cssText=""}setId(e){return this.id=e,this}setClass(e){return this.classname=e,this}setLeft(e){}setTop(e){}setWitdh(e){return this.width=e,this}setInnerHtml(e){return this.innerHtml=e,this}setInnerText(e){return this.innerText=e,this}createDiv(){const e=document.createElement("div");return e.id=this.id,e.className=this.classname,e.innerHTML=this.innerHtml,e.style.cssText=this.cssText,this.init(),e}createImg(){const e=document.createElement("img");return e.id=this.id,e.className=this.classname,e.style.cssText=this.cssText,this.init(),e}createSpan(){const e=document.createElement("span");return e.id=this.id,e.className=this.classname,e.innerHTML=this.innerHtml,e.style.cssText=this.cssText,this.init(),e}appendChild(e){return this.appendChild(e),this}setCSS(e){return this.cssText=e,this}init(){this.id="",this.classname="",this.innerHtml="",this.innerText="",this.cssText=""}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(4),o=n(11),a=n(10),s=n(9),p=n(7),r=n(2),l=n(0),c=n(6),u=n(5);class h{constructor(){this.settingIconID="pixiv-view-util-gear",this.outerContainerCSS="\n        position:absolute;\n        z-index:10000;\n        display:block;\n        background-color:#FFF;\n        border: 1px solid black;\n        ",this._iconElem=null,this.captionContainerCSS=`\n        white-space:pre-wrap;\n        z-index:10001;\n        position:relative;\n        width:auto;\n        height:auto;\n        display:none;\n        max-width:${window.innerWidth}px;\n        max-height:${window.innerHeight}px;\n        background-color:white;\n        word-wrap:break-word;\n        word-break:break-all;\n        \n        `,this.gearCSS="width: 25px; \n         height: 25px;\n         color:rgb(173, 173, 173);\n         ",this.modalCSS=".pixiv-modal {\n    display: none; /* Hidden by default */\n    position: fixed; /* Stay in place */\n    z-index:10000; /* Sit on top */\n    left: 0;\n    top: 0;\n    width: 100%; /* Full width */\n    height: 100%; /* Full height */\n    overflow: auto; /* Enable scroll if needed */\n    background-color: rgb(0,0,0); /* Fallback color */\n    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */\n}\n\n/* Modal Content/Box */\n#pixiv-modal-content {\n    background-color: #fefefe;\n    margin: 15% auto; /* 15% from the top and centered */\n    padding: 20px;\n    z-index:10001;\n    border: 1px solid #888;\n    width: 80%; /* Could be more or less, depending on screen size */\n}\n\n/* The Close Button */\n#pixiv-modal-close {\n    color: #aaa;\n    float: right;\n    font-size: 28px;\n    font-weight: bold;\n}\n\n#pixiv-modal-close :hover,\n#pixiv-modal-close :focus {\n    color: black;\n    text-decoration: none;\n    cursor: pointer;\n}\n",this.pixpediaItemCSS=".popup-pixpedia-icon{\n    display: inline-block;\n    margin-left: 2px;\n    width: 15px;\n    height: 14px;\n    vertical-align: -2px;\n    text-decoration: none;\n    background: url(https://s.pximg.net/www/images/inline/pixpedia.png) no-repeat;\n    }\n.popup-pixpedia-no-icon{\n    display: inline-block;\n    margin-left: 2px;\n    width: 15px;\n    height: 14px;\n    vertical-align: -2px;\n    text-decoration: none;\n     background: url(https://s.pximg.net/www/images/inline/pixpedia-no-item.png) no-repeat;\n}\n     "}innerContainerCSS(e){return`\n        border: 5px solid black;\n        background-color:#111;\n        position:relative;\n        width:100%;\n        height:100%;\n        float:left;\n        max-width:${window.innerWidth}px;\n        max-height:${window.innerHeight}px;\n        `}async setIconElem(e){const t=await GM_getResourceText("gearIcon"),n=(new l.ContainerFactory).setId(e).setCSS(this.gearCSS).setInnerHtml(t).createDiv();n.className="trigger";const i=n.getElementsByTagName("svg")[0],o=n.getElementsByTagName("g")[0];i.setAttribute("width","25"),i.setAttribute("height","25"),o.setAttribute("fill","#BECAD8");const a=document.createElement("li");a.className="viewUtil",a.appendChild(n),document.body.getElementsByClassName("notifications")[0].appendChild(a)}async setConfigDialog(){const e=this.settingIconID;null===document.getElementById(this.settingIconID)&&(await this.setIconElem(e),await this.setModal(e))}async initExecute(e,t){if(t.pagetype==i.pagetype.top&&null===document.getElementById(this.settingIconID)&&this.setConfigDialog(),e.usePopup&&t.isEnable(i.prop.popup_typeA)||t.isEnable(i.prop.popup_typeB)){const n=(new l.ContainerFactory).setId(h.outerContainerID).setClass(h.popupClass).setCSS(this.outerContainerCSS).createDiv();this.setPopup(n,t,e),console.log("set popup")}else{const e=document.getElementById(h.outerContainerID);e&&(e.style.display="none")}}onloadExecute(e,t){if(t.pagetype===i.pagetype.top&&null===document.getElementById("pixiv-view-util-gear")&&this.setConfigDialog(),e.changeIllustPageLayout&&t.isEnable(i.prop.changeIllustPageLayout)&&(h.changeIllustPageLayout(),console.log("layout chainged")),e.openComment&&t.isEnable(i.prop.openComment)&&(this.openComment(t),console.log("comment opend")),e.changeMemberPageLayout&&(t.pagetype===i.pagetype.member||t.pagetype===i.pagetype.member_illust)){this.changeMemberPageLayout();for(let e=0;e<5;e++)setTimeout(this.changeMemberPageLayout(),1e3*e)}}static checkPageType(e){return e.match("https://www.pixiv.net/bookmark_new_illust.php?")?i.pagetype.bookmark_new_illust:e.match("https://www.pixiv.net/discovery?")?i.pagetype.discovery:e.match("https://www.pixiv.net/member_illust.php?")?i.pagetype.member_illust:e.match("https://www.pixiv.net/member.php?")?i.pagetype.member:e.match("https://www.pixiv.net/bookmark_detail.php?")?i.pagetype.bookmark_detail:e.match("https://www.pixiv.net/bookmark_add.php?")?i.pagetype.bookmark_add:e.match("https://www.pixiv.net/ranking.php?")?i.pagetype.ranking:e.match(/https:\/\/www\.pixiv\.net\/bookmark\.php\?id/)?i.pagetype.bookmark_id:e.match("https://www.pixiv.net/search.php")?i.pagetype.search:e.match("https://www.pixiv.net/bookmark.php?")?i.pagetype.bookmark:e.match("https://www.pixiv.net/")?i.pagetype.top:i.pagetype.other}static changeIllustPageLayout(){$("figure").before($("figcaption"))}static getAllowedFuncList(e){switch(e){case i.pagetype.top:return[i.prop.popup_typeB];case i.pagetype.bookmark_new_illust:case i.pagetype.discovery:return[i.prop.popup_typeA];case i.pagetype.member_illust:return[i.prop.popup_typeB,i.prop.changeIllustPageLayout,i.prop.openComment];case i.pagetype.member:return[i.prop.popup_typeB,i.prop.changeMemberPageLayout];case i.pagetype.bookmark_detail:case i.pagetype.bookmark_add:case i.pagetype.bookmark_id:return[i.prop.popup_typeB];case i.pagetype.search:return[i.prop.popup_typeA];case i.pagetype.ranking:case i.pagetype.bookmark:return[i.prop.popup_typeB];default:return[]}}openComment(e){if(e.getURL.indexOf("mode=medium")>0){let e=$("article");e.find("[aria-expanded='false']").click(),new MutationObserver(function(t,n){e.find("[aria-expanded='false']").click()}).observe(document,{childList:!0,subtree:!0})}}setPopup(e,t,n){const i=new l.ContainerFactory,r=i.setId(h.innerContainerID).setClass(h.popupClass).setCSS(this.innerContainerCSS(n.popupScale)).createDiv(),d=i.setId(h.captionContainerID).setClass(h.popupClass).setCSS(this.captionContainerCSS).createDiv();e.appendChild(d),e.appendChild(r),document.body.appendChild(e);const m=document.createElement("style");m.textContent=this.pixpediaItemCSS,document.getElementsByTagName("head")[0].appendChild(m),$("body").on("mouseenter",'a[href*="member_illust.php?mode=medium&illust_id="]',function(){const i=$(this).find(".non-trim-thumb"),l=i.length>0?i[0]:this;$(this).attr("onclick","console.log();return false;"),$(this).find(".non-trim-thumb").attr("onclick","console.log();return false;");const m=this,g=this.getAttribute("href").match(/(.)+illust_id=([0-9]+)(&.+)?/),y=Number(g[2]);$(l).on("click",async function(i){await fetch(`https://www.pixiv.net/ajax/illust/${y}`,{method:"GET",mode:"cors",keepalive:!0}).then(function(e){if(e.ok)return e.json()}).then(async function(i){const l=new c.PixivJson(i);e.style.display="block";const g=h.isManga(l)?new a.Manga(l):new o.Illust(t,r,l);if(g.setInnerScreen=r,g.setClassName=h.popupClass,g.adjustScreenSize(n.popupScale),g.popup($(m).hasClass("on")),h.isManga(l)){e.style.width=r.style.width,e.style.height=r.style.height;const t=g.getOffset(e);e.style.top=`${t.top}px`,e.style.left=`${t.left}px`}if(n.popupCaption){const t=new p.Caption(l);t.setCaptionContainer(d),t.setInnerContainer(r),t.setClassName(h.popupClass),await t.popup(),t.adjustSize(e)}if(n.popupComment){const t=new u.CommentList(l);t.setCaptionContainer(d),t.setInnerContainer(r),t.setClassName(h.popupClass),await t.popup(),t.adjustSize(e)}h.adjustOffset(e),h.adjustSize(e,r,d),h.addMouseMove(e);g.imgScale;h.isUgoira(l)&&await fetch(`https://www.pixiv.net/ajax/illust/${l.body.illustId}/ugoira_meta`).then(function(e){return e.json()}).then(async t=>{const i=new s.Ugoira(l,new c.PixivJson(t));i.setInnerContainer(r),i.setClassName(h.popupClass),await i.init().then(()=>{i.resize(e,n.popupScale),i.popup(e)})})})})}),window.onresize=function(){e.style.maxWidth=`${window.innerWidth*n.popupScale}px`}}static adjustOffset(e){const t=h.getOffset(e);e.style.left=`${t.left}px`,e.style.top=`${t.top}px`}static adjustSize(e,t,n){e.style.width=`${t.clientWidth}px`,e.style.height=`${n.clientHeight+t.clientHeight}px`}isIllust(e){return 0===e.body.illustType}isManga(e){return 1===e.body.illustType||e.body.pageCount&&Number(e.body.pageCount)>1}isUgoira(e){return 2===e.body.illustType}static getUserID(e){return e.body.tags.authorId}static getPageNum(e){return Number(e.body.pageCount)}setModal(e){const t=new r.Setting,n=document.getElementById(e),i=document.createElement("div");i.innerHTML='  \n<div id="myModal" class="pixiv-modal">\n  <div id="pixiv-modal-content" >\n    <span id="pixiv-modal-close" >OK</span>\n    <p>Setting:</p>\n    <div id="pixiv-set-IllustPageLayout">\n    Modify the illust page\'s layout\n        <input type="radio"  name=\'pixivutil-setting1\' id="pixivutil-setting1-yes" value="1"  />\n        <label for="dummy_1" data-label="ON">ON</label>\n        <input type="radio"  name=\'pixivutil-setting1\' id="pixivutil-setting1-no" value="0"  checked  />\n        <label for="dummy_0" data-label="OFF">OFF</label>\n    </div>\n    <div id="pixiv-set-MemberPageLayout">\n     Modify the author page\'s layout\n        <input type="radio"  name=\'pixivutil-setting2\' id="pixivutil-setting2-yes" value="1"  />\n        <label for="dummy_1" data-label="ON">ON</label>\n        <input type="radio"  name=\'pixivutil-setting2\' id="pixivutil-setting2-no" value="0" checked   />\n        <label for="dummy_0" data-label="OFF">OFF</label>\n    </div>\n    <div id="pixiv-set-Popup">\n     Use popup function\n        <input type="radio"  name=\'pixivutil-setting3\' id="pixivutil-setting3-yes" value="1" />\n        <label for="dummy_1" data-label="ON">ON</label>\n        <input type="radio"  name=\'pixivutil-setting3\' id="pixivutil-setting3-no" value="0"  checked   />\n        <label for="dummy_0" data-label="OFF">OFF</label>\n    </div>\n    <div id="pixiv-set-PopupCaption">\n     Popup caption\n        <input type="radio"  name=\'pixivutil-setting4\' id="pixivutil-setting4-yes" value="1"/>\n        <label for="dummy_1" data-label="ON">ON</label>\n        <input type="radio"  name=\'pixivutil-setting4\' id="pixivutil-setting4-no" value="0" checked  />\n        <label for="dummy_0" data-label="OFF">OFF</label>\n    </div>\n    <div >\n    Popup size (min <-> max)\n      <input type="range" value="0.7" min="0.3" max="1.2" step="0.1" id="pixiv-set-Scale" />\n    </div>\n  </div>\n</div>\n\t',document.body.appendChild(i);const o=document.createElement("style");o.textContent=this.modalCSS,document.getElementsByTagName("head")[0].appendChild(o);const a=document.getElementById("myModal"),s=document.getElementById("pixiv-modal-close");n.onclick=(()=>a.style.display="block");const p=document.getElementsByName("pixivutil-setting1")[0],l=document.getElementsByName("pixivutil-setting2")[0],c=document.getElementsByName("pixivutil-setting3")[0],u=document.getElementsByName("pixivutil-setting4")[0],h=document.getElementById("pixiv-set-Scale");t.init().then(()=>{t.changeIllustPageLayout&&!p.checked&&(p.checked=!0),t.changeMemberPageLayout&&!l.checked&&(l.checked=!0),t.usePopup&&!c.checked&&(c.checked=!0),t.popupCaption&&!u.checked&&(u.checked=!0),h.value=String(t.popupScale)}),s.onclick=(()=>{a.style.display="none",t.changeIllustPageLayout=p.checked,t.changeMemberPageLayout=l.checked,t.usePopup=c.checked,t.popupCaption=u.checked,t.popupScale=h.value,t.save()}),window.onclick=function(e){e.target==a&&(a.style.display="none")}}changeMemberPageLayout(){const e=document.getElementsByTagName("h2");if(void 0!==e)for(const t of e)if(t.innerText.startsWith("イラスト")){const e=t.parentElement.parentElement,n=document.getElementsByTagName("header")[0];n.parentNode.insertBefore(e,n.nextSibling);break}}static isIllust(e){return 0===e.body.illustType}static isManga(e){return 1===e.body.illustType||e.body.pageCount&&Number(e.body.pageCount)>1}static isUgoira(e){return 2===e.body.illustType}static addMouseMove(e){let t=0,n=0,i=0,o=0,a=!1;const s=s=>{a=!0,(s=s||window.event).preventDefault(),t=i-s.clientX,n=o-s.clientY,i=s.clientX,o=s.clientY,e.style.top=e.offsetTop-n+"px",e.style.left=e.offsetLeft-t+"px"},p=()=>{document.onmouseup=null,document.onmousemove=null,a||this.cleanContainer(e),a=!1};e.onmousedown=(t=>{(t=t||window.event).offsetX<=t.target.clientWidth&&t.offsetY<=t.target.clientHeight&&(t.preventDefault(),i=t.clientX,o=t.clientY,document.onmouseup=p,document.onmousemove=s,e.onmouseleave=(()=>{this.cleanContainer(e)}))})}removePopup(){const e=document.getElementById(h.outerContainerID);h.removeContainer(e)}static cleanContainer(e){const t=document.getElementById(this.innerContainerID),n=document.getElementById(this.captionContainerID);t.innerText="",n.innerText="",e.style.display="none"}static removeContainer(e){e.innerText="",e.parentNode.removeChild(e)}static getOffset(e){const t=$(window).height(),n=$(window).width(),i=$(e).height(),o=$(e).width(),a=$(window).scrollTop()+(t-i)/2,s=(n-o)/2;return{top:Math.round(a),left:Math.round(s)}}}h.innerContainerID="popup-inner-container",h.outerContainerID="popup-outer-container",h.captionContainerID="popup-caption-container",h.popupClass="popup-util",t.Util=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(4);t.Setting=class{constructor(){this.changeIllustPageLayout=!0,this.changeMemberPageLayout=!0,this.openComment=!0,this.usePopup=!0,this.popupCaption=!0,this.popupComment=!0,this.popupScale=.7,this.uiComponent=[i.uiComponent.image,i.uiComponent.manga,i.uiComponent.ugoira,i.uiComponent.caption]}async init(){await GM.getValue("pixiv_viewutil_setting").then(e=>{if(void 0!==e){const t=JSON.parse(e);this.changeIllustPageLayout=null==t.changeIllustPageLayout||t.changeIllustPageLayout,this.changeMemberPageLayout=null==t.changeMemberPageLayout||t.changeMemberPageLayout,this.openComment=null==t.openComment||t.openComment,this.usePopup=null==t.usePopup||t.usePopup,this.popupCaption=null==t.popupCaption||t.popupCaption,this.popupComment=null==t.popupComment||t.popupComment,this.popupScale=null==t.popupScale?.7:t.popupScale}})}set setStringData(e){const t=JSON.parse(e);this.setData(t)}set setData(e){this.changeIllustPageLayout=null==e.changeIllustPageLayout||e.changeIllustPageLayout,this.changeMemberPageLayout=null==e.changeMemberPageLayout||e.changeMemberPageLayout,this.openComment=null==e.openComment||e.openComment,this.usePopup=null==e.usePopup||e.usePopup,this.popupCaption=null==e.popupCaption||e.popupCaption,this.popupComment=null==e.popupComment||e.popupComment,this.popupScale=null==e.usePopup?.7:e.popupScale}get getJsonString(){const e={changeIllustPageLayout:this.changeIllustPageLayout,changeMemberPageLayout:this.changeMemberPageLayout,openComment:this.openComment,usePopup:this.usePopup,popupCaption:this.popupCaption,popupComment:this.popupComment,popupScale:this.popupScale};return JSON.stringify(e)}save(){GM.setValue("pixiv_viewutil_setting",this.getJsonString)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArtWork=class{constructor(){this.imgScale=.7}adjustScreenSize(e){const t=this.pixivJson.body.width,n=this.pixivJson.body.height;let i=t,o=n;if(n>window.innerHeight*e||t>window.innerWidth*e){const a=Number(window.innerHeight*e)/n,s=Number(window.innerWidth*e)/t;a<s?(o*=a,i*=a,this.imgScale=a):(o*=s,i*=s,this.imgScale=s)}const a=this.innerScreen;a.style.width=`${Math.round(i)}px`,a.style.height=`${Math.round(o)}px`}popup(e){}getOffset(e){const t=$(window).height(),n=$(window).width(),i=$(e).height(),o=$(e).width(),a=$(window).scrollTop()+(t-i)/2,s=(n-o)/2;return{top:Math.round(a),left:Math.round(s)}}set setInnerScreen(e){this.innerScreen=e}set setClassName(e){this.className=e}getClassName(){return this.className}set setImgScale(e){this.imgScale=e}getInnerScreen(){return this.innerScreen}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.changeIllustPageLayout=0]="changeIllustPageLayout",e[e.changeMemberPageLayout=1]="changeMemberPageLayout",e[e.popup_typeA=2]="popup_typeA",e[e.popup_typeB=3]="popup_typeB",e[e.openComment=4]="openComment"}(t.prop||(t.prop={})),function(e){e[e.image=0]="image",e[e.manga=1]="manga",e[e.ugoira=2]="ugoira",e[e.caption=3]="caption"}(t.uiComponent||(t.uiComponent={})),function(e){e[e.top=0]="top",e[e.bookmark_new_illust=1]="bookmark_new_illust",e[e.discovery=2]="discovery",e[e.member_illust=3]="member_illust",e[e.member=4]="member",e[e.bookmark_detail=5]="bookmark_detail",e[e.bookmark_add=6]="bookmark_add",e[e.ranking=7]="ranking",e[e.bookmark_id=8]="bookmark_id",e[e.search=9]="search",e[e.bookmark=10]="bookmark",e[e.other=11]="other"}(t.pagetype||(t.pagetype={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CommentList=class{constructor(e){this.commentListContainerID="popup-commentlist-container",this.commentListContainerCSS="\n        \n        \n        ",this.pixivJson=e}setCaptionContainer(e){}setInnerContainer(e){}setClassName(e){}popup(){}adjustSize(e){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PixivJson=class{constructor(e){Object.assign(this,e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),o=n(1);t.Caption=class{constructor(e){this.captionContainerID="popup-caption-container",this.captionDescriptionID="popup-caption-text",this.captionTagID="popup-caption-tag",this.captionDateID="popup-caption-date",this.captionLikeID="popup-caption-like",this.captionBookmarkID="popup-caption-bookmark",this.captionViewID="popup-caption-view",this.captionInfoID="popup-caption-infomation",this.likeIcon='<img src="https://s.pximg.net/www/js/spa/260127df5fe9ade778ec4be463deaf01.svg" width="12" height="12">',this.bookmarkIcon='<svg viewBox="0 0 12 12" width="12" height="12" class="css-1hamw6p e1rs6xf14"><path fill="currentColor" d="\n        M9,0.75 C10.6568542,0.75 12,2.09314575 12,3.75 C12,6.68851315 10.0811423,9.22726429 6.24342696,11.3662534\n        L6.24342863,11.3662564 C6.09210392,11.4505987 5.90790324,11.4505988 5.75657851,11.3662565\n        C1.9188595,9.22726671 0,6.68851455 0,3.75 C1.1324993e-16,2.09314575 1.34314575,0.75 3,0.75\n        C4.12649824,0.75 5.33911281,1.60202454 6,2.66822994 C6.66088719,1.60202454 7.87350176,0.75 9,0.75 Z"></path></svg>',this.viewIcon='<img src="https://s.pximg.net/www/js/spa/af74d092363c09fd06441a4ab04c9331.svg" width="14" height="12">',this.captionContainerCSS=`\n        white-space:pre-wrap;\n        z-index:10001;\n        position:relative;\n       \n        width:auto;\n        height:auto;\n        max-width:${window.innerWidth}px;\n        max-height:${window.innerHeight}px;\n        background-color:white;\n        word-wrap:break-word;\n        word-break:break-all;\n        `,this.descriptionContainerCSS="font-size: normal; \n          width: auto; \n          height:auto;\n          overflow-y:scroll;",this.infoContainerCSS="\n        background-color:white;\n        font-size:xx-small;\n        width: auto;\n        color:rgb(173, 173, 173); \n        line-height=1;",this.pixivJson=e}popup(){const e=this.captionContainer,t=(this.innerContainer,this.pixivJson);e.innerText="";const n=new i.ContainerFactory,o=n.setId(this.captionDescriptionID).setClass(this.className).setCSS(this.descriptionContainerCSS).setInnerHtml(t.body.description).createDiv(),a=n.setId(this.captionTagID).setClass(this.className).createDiv();a.appendChild(this.getTagHtml(t));const s=new Date(t.body.createDate),p=`upload:${s.getFullYear()}/${s.getMonth()+1}/${s.getDate()} ${s.getHours()}:${String(s.getMinutes()).padStart(2,"0")}`,r=n.setId(this.captionDateID).setInnerHtml(p).createDiv(),l=`${this.likeIcon} ${t.body.likeCount} `,c=n.setId(this.captionLikeID).setClass(this.className).setInnerHtml(l).createSpan(),u=`${this.bookmarkIcon} ${t.body.bookmarkCount} `,h=n.setId(this.captionBookmarkID).setClass(this.className).setInnerHtml(u).createSpan(),d=`${this.viewIcon}${t.body.viewCount}`,m=n.setId(this.captionViewID).setClass(this.className).setInnerHtml(d).createSpan(),g=n.setId(this.captionInfoID).setClass(this.className).setCSS(this.infoContainerCSS).createDiv();g.appendChild(r),g.appendChild(c),g.appendChild(h),g.appendChild(m),e.appendChild(o),e.appendChild(a),e.appendChild(g),this.descriptionElem=o,this.tagElem=a,this.infoElem=g,e.style.display="block"}getTagHtml(e){let t=document.createElement("ul");t.style.paddingInlineStart="0px";for(const n of e.body.tags.tags){let e=document.createElement("a");e.className=`${n.romaji||n.locked?"popup-pixpedia-icon":"popup-pixpedia-no-icon"}`,e.setAttribute("href",`https://dic.pixiv.net/a/${n.tag}`);let i=document.createElement("li");i.innerHTML=` ${n.locked?"<span>＊<span>":""}${n.tag}`,i.style.cssText="display: inline-block;",i.appendChild(e),t.appendChild(i)}return t}setInnerContainer(e){this.innerContainer=e}setClassName(e){this.className=e}adjustSize(e){this.descriptionElem.style.height=this.descriptionElem.clientHeight>100?"100px":`${this.descriptionElem.clientHeight}px`;const t=o.Util.getOffset(e);e.style.left=`${t.left}px`,e.style.top=`${t.top}px`,this.captionContainer.style.width=`${this.innerContainer.offsetWidth}px`,e.style.width=`${this.innerContainer.clientWidth}px`,e.style.height=`${this.captionContainer.clientHeight+this.innerContainer.clientHeight}px`}getOffset(e){const t=$(window).height(),n=$(window).width(),i=$(e).height(),o=$(e).width(),a=$(window).scrollTop()+(t-i)/2,s=(n-o)/2;return{top:Math.round(a),left:Math.round(s)}}setCaptionContainer(e){this.captionContainer=e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Frame=class{constructor(){this.imgArray=[],this._imgStringArray=[],this._frameArray=[]}pushDelay(e){this._frameArray.push(e)}pushImgString(e){this._imgStringArray.push(e)}get imgStringArray(){return this._imgStringArray}set imgStringArray(e){this._imgStringArray=e}set frameArray(e){this._frameArray=e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(8),o=n(0);class a{constructor(e,t){this.ugoiraContainerID="popup-ugoira",this.pixivJson=e,this.ugoiraMetaJson=t}async init(){const e=this.innerContainer;let t=!1;new o.ContainerFactory;e.textContent=null;const n=document.createElement("canvas");n.id=this.ugoiraContainerID,n.className=this.className,this.ugoiraContainer=n,e.appendChild(n);let a=new Headers;a.append("Accept-Encoding","gzip, deflate, br"),a.append("Connection","keep-alive"),a.append("HOST","www.pixiv.net");let s=new JSZip;const p=this.ugoiraMetaJson.body.frames,r=new i.Frame;await fetch(this.ugoiraMetaJson.body.src,{method:"GET",headers:a,mode:"cors",keepalive:!0}).then(e=>{if(e.ok)return e.blob()}).then(async e=>{await s.loadAsync(e,{base64:!0})}).then(()=>{for(let e=0;e<p.length;e++)s.file(p[e].file).async("base64",function(e){console.log("progression: "+e.percent.toFixed(2)+" %"),100===e.percent&&(t=!0)}).then(function(e){r.pushImgString(`data:image/jpeg;base64,${e}`)},function(e){console.log("download error.")})}).then(()=>{this.frameData=r})}setInnerContainer(e){this.innerContainer=e}resize(e,t){const n=this.pixivJson.body.width,i=this.pixivJson.body.height;let o=n,a=i;if(i>window.innerHeight*t||n>window.innerWidth*t){const e=i/Number(window.innerHeight*t),s=n/Number(window.innerWidth*t);e>s?(a/=e,o/=e):(a/=s,o/=s)}this.ugoiraContainer.width=o,this.ugoiraContainer.height=a,e.style.width=`${Math.round(o)}px`,e.style.height=`${Math.round(a)}px`}popup(e){this.frameData.frameArray;const t=this.frameData.imgStringArray,n=new Image;let i=0;const o=()=>{n.src=t[i],this.ugoiraContainer.getContext("2d").drawImage(n,0,0,this.ugoiraContainer.clientWidth,this.ugoiraContainer.clientHeight),"none"!==e.style.display&&(setTimeout(o,this.ugoiraMetaJson.body.frames[i].delay),i=(i+=1)===t.length?0:i)};o()}setClassName(e){this.className=e}}a.imgArray=[],a.imgStringArray=[],t.Ugoira=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),o=n(3);t.Manga=class extends o.ArtWork{constructor(e){super(),this.mangaContainerID="popup-manga",this.pageNum=0,this.mangaContainerCSS=" background-color:black;\n           overflow-x:auto;\n           white-space:nowrap;\n           width: 100%; \n           height:auto;\n           top:0;\n           left:0;\n            ",this.pixivJson=e,this.pageNum=this.getPageNum(e),this.imgArray=new Array(this.pageNum);const t=new i.ContainerFactory;this.mangaContainer=t.setId(this.mangaContainerID).setClass(this.className).setCSS(this.mangaContainerCSS).createDiv(),this.DELTASCALE="mozInnerScreenX"in window?70:4}adjustScreenSize(e){const t=this.innerScreen;t.style.width=`${window.innerWidth*e}px`,t.style.height=`${window.innerHeight*e}px`}popup(e){this.innerScreen.style.display="block",this.innerScreen.style.width=`${Number(this.innerScreen.style.maxWidth)*this.imgScale}px`,this.innerScreen.style.height=`${Number(this.innerScreen.style.maxHeight)*this.imgScale}px`,this.innerScreen.innerHTML="",this.innerScreen.style.backgroundColor=e?"rgb(255, 64, 96)":"rgb(34, 34, 34)";const t=this.getImgUrl();this.initImgArray(this.mangaContainer,t),this.innerScreen.appendChild(this.mangaContainer),this.setScrool(this.mangaContainer,this.innerScreen,this.DELTASCALE)}initImgArray(e,t){for(let n=0;n<this.pageNum;n++){const i=document.createElement("img");i.src=t.replace("p0","p"+n),i.style.maxWidth=this.innerScreen.style.width,i.style.maxHeight=this.innerScreen.style.height,i.style.height=this.innerScreen.style.height,i.style.width="auto",this.imgArray.push(i),e.appendChild(i)}}setScrool(e,t,n){this.mangaContainer.onwheel=function(i){i.deltaY<0&&t.getBoundingClientRect().top<0?t.scrollIntoView({block:"start",behavior:"smooth"}):i.deltaY>0&&t.getBoundingClientRect().bottom>document.documentElement.clientHeight&&t.scrollIntoView({block:"end",behavior:"smooth"});let o=e.scrollLeft;(o>0&&i.deltaY<0||o<e.scrollWidth-e.clientWidth&&i.deltaY>0)&&(i.preventDefault(),e.scrollLeft+=i.deltaY*n)}}getImgUrl(){return this.pixivJson.body.urls.regular.replace(/\/...x...\//,"/600x600/")}getPageNum(e){return Number(e.body.pageCount)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),o=n(3);t.Illust=class extends o.ArtWork{constructor(e,t,n){super(),this.illustContainerID="popup-img",this.illustContainerCSS="width: 100%; \n          height:100%;\n          display:none;\n          left: 0;\n          top: 0;\n          background-size: contain;\n          background-position:center; \n          background-repeat:no-repeat;\n            ",this.pixivJson=n,this.innerContainer=t,this.innerContainer.innerHTML="";const o=new i.ContainerFactory;this.illustContainer=o.setId(this.className).setClass(this.className).setCSS(this.illustContainerCSS).createDiv();const a=this.illustContainer;t.appendChild(a),this.innerContainer.appendChild(a),a.style.display="none",a.style.backgroundImage=`url(${this.pixivJson.body.urls.regular})`,a.style.left="0",a.style.top="0",a.style.width="100%",a.style.height="100%",a.style.backgroundSize="contain",a.style.backgroundPosition="center",a.style.backgroundRepeat="no-repeat"}popup(e){this.innerContainer.style.backgroundColor=e?"rgb(255, 64, 96)":"rgb(34, 34, 34)",this.illustContainer.style.display="block"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1);t.Page=class{constructor(e){this.URL=e,this.pagetype=i.Util.checkPageType(e),this.siteImgMaxWidth=500,this.alloedFunclist=i.Util.getAllowedFuncList(this.pagetype),this.imgSelector='a[href*="member_illust.php?mode=medium&illust_id="]',this.mangaSelector='a[href*="member_illust.php?mode=medium&illust_id="] > div:nth-child(2) '}set setURL(e){this.URL=e,this.pagetype=i.Util.checkPageType(e)}get getURL(){return this.URL}get getFunclist(){return this.alloedFunclist}isEnable(e){return this.alloedFunclist.indexOf(e)>-1}get getPagetype(){return this.pagetype}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(12),o=n(1),a=n(2),s=new i.Page(document.URL),p=new o.Util,r=new a.Setting;r.init().then(()=>{p.initExecute(r,s)}),window.onload=(()=>{console.log("pagetype:"+s.pagetype.toString()),p.onloadExecute(r,s);const e=document.getElementsByTagName("a");for(const t of e)t.addEventListener("click",()=>{p.onloadExecute(r,new i.Page(document.URL))});r.save()})}])}]);