!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.changeIllustPageLayout=0]="changeIllustPageLayout",e[e.changeMemberPageLayout=1]="changeMemberPageLayout",e[e.popup_typeA=2]="popup_typeA",e[e.popup_typeB=3]="popup_typeB",e[e.openComment=4]="openComment"}(t.prop||(t.prop={})),function(e){e[e.image=0]="image",e[e.manga=1]="manga",e[e.caption=2]="caption"}(t.uiComponent||(t.uiComponent={})),function(e){e[e.top=0]="top",e[e.bookmark_new_illust=1]="bookmark_new_illust",e[e.discovery=2]="discovery",e[e.member_illust=3]="member_illust",e[e.member=4]="member",e[e.bookmark_detail=5]="bookmark_detail",e[e.bookmark_add=6]="bookmark_add",e[e.ranking=7]="ranking",e[e.bookmark_id=8]="bookmark_id",e[e.search=9]="search",e[e.bookmark=10]="bookmark",e[e.other=11]="other"}(t.pagetype||(t.pagetype={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),i=n(4);class a{static checkPageType(e){return e.match("https://www.pixiv.net/bookmark_new_illust.php?")?o.pagetype.bookmark_new_illust:e.match("https://www.pixiv.net/discovery?")?o.pagetype.discovery:e.match("https://www.pixiv.net/member_illust.php?")?o.pagetype.member_illust:e.match("https://www.pixiv.net/member.php?")?o.pagetype.member:e.match("https://www.pixiv.net/bookmark_detail.php?")?o.pagetype.bookmark_detail:e.match("https://www.pixiv.net/bookmark_add.php?")?o.pagetype.bookmark_add:e.match("https://www.pixiv.net/ranking.php?")?o.pagetype.ranking:e.match(/https:\/\/www\.pixiv\.net\/bookmark\.php\?id/)?o.pagetype.bookmark_id:e.match("https://www.pixiv.net/search.php")?o.pagetype.search:e.match("https://www.pixiv.net/bookmark.php?")?o.pagetype.bookmark:e.match("https://www.pixiv.net/")?o.pagetype.top:o.pagetype.other}static changeIllustPageLayout(){document.getElementsByTagName("figure");$("figure").before($("figcaption"))}static changeMemberPageLayout(){const e=$("h2");for(const t of e)if(t.innerText.startsWith("イラスト")){const e=$(t).parent().parent();$("header").next().prepend(e);break}}static getAllowedFuncList(e){switch(e){case o.pagetype.top:return[o.prop.popup_typeB];case o.pagetype.bookmark_new_illust:case o.pagetype.discovery:return[o.prop.popup_typeA];case o.pagetype.member_illust:return[o.prop.popup_typeB,o.prop.changeIllustPageLayout,o.prop.openComment];case o.pagetype.member:return[o.prop.popup_typeB,o.prop.changeMemberPageLayout];case o.pagetype.bookmark_detail:case o.pagetype.bookmark_add:case o.pagetype.bookmark_id:return[o.prop.popup_typeB];case o.pagetype.search:return[o.prop.popup_typeA];case o.pagetype.ranking:case o.pagetype.bookmark:return[o.prop.popup_typeB];default:return[]}}openComment(e){if(e.getURL.indexOf("mode=medium")>0){let e=$("article");e.find("[aria-expanded='false']").click(),new MutationObserver(function(t,n){e.find("[aria-expanded='false']").click()}).observe(document,{childList:!0,subtree:!0})}}setPopup(e,t){const n=new i.PopupUtil,o=n.getCaptionContainer(),p=n.getOuterContainer(document);document.body.appendChild(o),document.body.appendChild(p),$("body").on("mouseenter",'a[href*="member_illust.php?mode=medium&illust_id="]',function(){const t=$(this).find(".non-trim-thumb"),o=t.length>0?t[0]:this;$(this).attr("onclick","console.log();return false;"),$(this).find(".non-trim-thumb").attr("onclick","console.log();return false;");const i=this,l=this.getAttribute("href").match(/(.)+illust_id=([0-9]+)(&.+)?/),s=Number(l[2]);$(o).on("click",function(t){fetch(`https://www.pixiv.net/ajax/illust/${s}`).then(function(e){return e.json()}).then(function(o){t.pageX,t.pageY;if(n.isManga(o)){const e=a.getPageNum(o);n.popupManga(p,i,o,Number(e))}else n.popupImg(e,p,i,o);n.popupCaption(p,o)})})});const l=()=>{const e=document.getElementById("captionContainer");e.innerText=null,e.style.display="none";const t=p.children;for(const e of t)e.style.display="none";p.textContent=null,p.style.display="none"};p.onmouseleave=function(){0==$(o).find("a").length?l():setTimeout(l(),1e3)},o.onmouseleave=function(){o.innerText=null,o.style.display="none"},window.onresize=function(){p.style.maxWidth=document.body.clientWidth-80}}static getUserID(e){return e.body.tags.authorId}static getPageNum(e){return Number(e.body.pageCount)}}t.Util=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(0);t.Setting=class{constructor(e){const t=JSON.parse(e);this.changeIllustPageLayout=null==t.changeIllustPageLayout||t.changeIllustPageLayout,this.changeMemberPageLayout=null==t.changeMemberPageLayout||t.changeMemberPageLayout,this.openComment=null==t.openComment||t.openComment,this.popup=null==t.popup||t.popup,this.uiComponent=[o.uiComponent.image,o.uiComponent.manga,o.uiComponent.caption]}set setData(e){this.changeIllustPageLayout=null==e.changeIllustPageLayout||e.changeIllustPageLayout,this.changeMemberPageLayout=null==e.changeMemberPageLayout||e.changeMemberPageLayout,this.openComment=null==e.openComment||e.openComment,this.popup=null==e.popup||e.popup}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Manga=class{constructor(){this.followedUsersId=[],this.BOOKMARK_URL="https://www.pixiv.net/bookmark.php",this.CheckedPublic=!1,this.Checked=!1,this.artsLoaded=0,this.hits=0,this.isRunning=!1,this.lastImgId=" ",this.siteImgMaxWidth=150,this.mangaWidth=1200,this.pageNum=0,this.imgsArr=[],this.DELTASCALE="mozInnerScreenX"in window?70:4}set LastImgId(e){this.lastImgId=e}getLastImgId(){return this.lastImgId}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),i=n(0);t.PopupUtil=class{constructor(){this.likeIcon='<img src="https://s.pximg.net/www/js/spa/260127df5fe9ade778ec4be463deaf01.svg" width="12" height="12">',this.bookmarkIcon='<svg viewBox="0 0 12 12" width="12" height="12" class="css-1hamw6p e1rs6xf14"><path fill="currentColor" d="\n        M9,0.75 C10.6568542,0.75 12,2.09314575 12,3.75 C12,6.68851315 10.0811423,9.22726429 6.24342696,11.3662534\n        L6.24342863,11.3662564 C6.09210392,11.4505987 5.90790324,11.4505988 5.75657851,11.3662565\n        C1.9188595,9.22726671 0,6.68851455 0,3.75 C1.1324993e-16,2.09314575 1.34314575,0.75 3,0.75\n        C4.12649824,0.75 5.33911281,1.60202454 6,2.66822994 C6.66088719,1.60202454 7.87350176,0.75 9,0.75 Z"></path></svg>',this.viewIcon='<img src="https://s.pximg.net/www/js/spa/af74d092363c09fd06441a4ab04c9331.svg" width="14" height="12">'}getImgContainer(){let e=document.createElement("div");return e.id="imgContainer",e.style.display="block",e.style.zIndex="1000",e.style.backgroundColor="#222",e.style.maxWidth="1200px",e.style.whiteSpace="nowrap",e.style.padding="5px",e.style.margin="5px",e.style.maxWidth,window.innerHeight,e.style.width="auto",e.style.maxHeight=.7*window.innerHeight+"px",e.style.height="auto",e}getImageElement(){let e=document.createElement("img");return e.id="popupImg",e.style.maxWidth=.7*window.innerWidth+"px",e.style.width="auto",e.style.maxHeight=.7*window.innerHeight+"px",e.style.height="auto",e}getMangaContainer(e){let t=e.createElement("div");return t.id="mangaContainer",t.style.display="block",t.style.zIndex="1500",t.style.backgroundColor="#111",t.style.overflowX="auto",t.style.top="0px",t.style.left="0px",t.style.whiteSpace="nowrap",t}getOuterContainer(e){let t=e.createElement("div");e.body.appendChild(t);let n=e.createElement("div");return n.id="outerContainer",t.appendChild(n),n.style.position="absolute",n.style.display="block",n.style.zIndex="1000",n.style.padding="5px",n.style.backgroundColor="#111",n.style.left="0px",n.style.left="0px",n.style.maxWidth=.7*window.innerWidth+"px",n.style.maxHeight=.7*window.innerHeight+"px",n}getCaptionContainer(){let e=document.createElement("div");return e.id="captionContainer",(e=document.createElement("div")).style.whiteSpace="nowrap",e.style.display="block",e.style.zIndex="1001",e.style.position="absolute",e.style.padding="5px",e.style.maxWidth=.7*window.innerWidth+"px",e.style.top="0px",e.style.left="0px",e.style.backgroundColor="#FFF",e}popupImg(e,t,n,o){const i=t.children;for(const e of i)e.style.display="none";t.textContent=null;const a=this.getImgContainer();t.appendChild(a);const p=this.getImageElement();a.appendChild(p);let l=Number(o.body.height),s=Number(o.body.width);if(l>.6*window.innerHeight||s>.6*window.innerWidth){const e=l/(.8*window.innerHeight),t=s/(.8*window.innerWidth);e>t?(l/=e,s/=e):(l/=t,s/=t)}p.src=this.getImgUrl(o),$(n).hasClass("on")?$(t).css("background","rgb(255, 64, 96)"):$(t).css("background","rgb(34, 34, 34)"),$(t).width(s+"px"),$(t).height(l+"px");const r=this.getOffset(t);t.style.top=r.top+"px",t.style.left=r.left+"px",a.style.display="block",t.style.display="block"}getOffset(e){const t=$(window).height(),n=$(window).width(),o=$(e).height(),i=$(e).width(),a=$(window).scrollTop()+(t-o)/2,p=(n-i)/2;return{top:Math.round(a),left:Math.round(p)}}popupCaption(e,t){let n=this.getCaptionContainer();const o="captionContainer";let i;null!=document.getElementById(o)?((i=document.getElementById(o)).innerText=null,i.style.display="none"):((i=n).id=o,$(i).insertBefore(e)),i.style.left=e.style.left;let a=document.createElement("div");a.id="popup-caption-text",a.innerHTML=t.body.description,i.appendChild(a);let p=document.createElement("div");p.id="popup-caption-date";const l=new Date(t.body.createDate);p.innerHTML=`upload:${l.getFullYear()}/${l.getMonth()+1}/${l.getDate()} ${l.getHours()}:${l.getMinutes()}`;let s=document.createElement("div"),r=document.createElement("span");r.innerHTML=`${this.likeIcon} ${t.body.likeCount} `;let c=document.createElement("span");c.innerHTML=`${this.bookmarkIcon} ${t.body.bookmarkCount} `;let u=document.createElement("span");u.id="popup-caption-view",u.innerHTML=`${this.viewIcon}${t.body.viewCount}`,s.appendChild(p),s.appendChild(r),s.appendChild(c),s.appendChild(u),i.appendChild(s),s.style.fontSize="12px",s.style.color="rgb(173, 173, 173)",s.style.lineHeight="1",i.style.display="block",i.style.width=e.clientWidth+"px",i.style.width=`${Number(t.body.width)/2}px`,i.style.backgroundColor="white",i.style.wordWrap="break-word",i.style.wordBreak="break-all",i.style.whiteSpace="normal";const d=parseInt(e.style.top)-parseInt(i.getBoundingClientRect().height);i.style.top=d+"px"}popupManga(e,t,n,i){const a=this.getMangaContainer(document);e.appendChild(a);const p=new o.Manga,l=e.children;for(const e of l)e.style.display="none";$(t).hasClass("on")?$(e).css("background","rgb(255, 64, 96)"):$(e).css("background","rgb(34, 34, 34)"),this.imgsArrInit(e,a,p,this.getImgUrl(n),i),$(e).width(e.style.maxWidth),$(e).height(e.style.maxHeight);const s=this.getOffset(e);e.style.top=s.top+"px",e.style.left=s.left+"px",a.style.display="block",e.style.display="block",this.setScrool(e,a,p)}getImgUrl(e){return e.body.urls.regular.replace(/\/...x...\//,"/600x600/")}imgsArrInit(e,t,n,o,i){n.pageNum=i;for(let a=0;a<i;a++)n.imgsArr.push(document.createElement("img")),t.appendChild(n.imgsArr[a]),n.imgsArr[a].src=o.replace("p0","p"+a),n.imgsArr[a].style.maxWidth=e.style.maxWidth,n.imgsArr[a].style.maxHeight=e.style.maxHeight,n.imgsArr[a].style.height=e.style.maxHeight,n.imgsArr[a].style.width="auto"}getImageIDfromString(e){const t=e.match(/(.)+illust_id=([0-9]+)(&.+)?/)[2];return Number(t)}setScrool(e,t,n){t.onwheel=function(o){o.deltaY<0&&e.getBoundingClientRect().top<0?e.scrollIntoView({block:"start",behavior:"smooth"}):o.deltaY>0&&e.getBoundingClientRect().bottom>document.documentElement.clientHeight&&e.scrollIntoView({block:"end",behavior:"smooth"});let i=t.scrollLeft;(i>0&&o.deltaY<0||i<t.scrollWidth-t.clientWidth&&o.deltaY>0)&&(o.preventDefault(),t.scrollLeft+=o.deltaY*n.DELTASCALE)}}getHrefElement(e,t,n){return e.pagetype===i.pagetype.member_illust?$(n).parent()[0]:$(n).parent().find("a")[0]}isManga(e){return"1"===e.body.illustType||e.body.pageCount&&Number(e.body.pageCount)>1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1);t.Page=class{constructor(e){this.URL=e,this.pagetype=o.Util.checkPageType(e),this.siteImgMaxWidth=500,this.alloedFunclist=o.Util.getAllowedFuncList(this.pagetype),this.imgSelector='a[href*="member_illust.php?mode=medium&illust_id="]',this.mangaSelector='a[href*="member_illust.php?mode=medium&illust_id="] > div:nth-child(2) '}set setURL(e){this.URL=e,this.pagetype=o.Util.checkPageType(e)}get getURL(){return this.URL}get getFunclist(){return this.alloedFunclist}isEnable(e){return this.alloedFunclist.indexOf(e)>-1}get getPagetype(){return this.pagetype}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(5),i=n(0),a=n(1),p=n(2);let l,s=new o.Page(document.URL),r=new a.Util;(async()=>{return await GM.getValue("pixiv_viewutil_setting",JSON.stringify({changeIllustPageLayout:!0,changeMemberPageLayout:!0,openComment:!0,popup:!0}))})().then(e=>{if(l=new p.Setting(e),console.log("popup set"),l.popup&&s.isEnable(i.prop.popup_typeA)?(r.setPopup(s,l),console.log("popup  A is enable")):l.popup&&s.isEnable(i.prop.popup_typeB)&&(r.setPopup(s,l),console.log("popup  B is enable")),l.changeMemberPageLayout&&s.isEnable(i.prop.changeMemberPageLayout)){const e=document.getElementsByTagName("header")[0].nextElementSibling.children[0].children[0];document.getElementById("root").appendChild(e),console.log("layout chainged")}}),window.onload=(()=>{if(console.log("pagetype:"+s.pagetype.toString()),l.changeIllustPageLayout&&s.isEnable(i.prop.changeIllustPageLayout)&&(a.Util.changeIllustPageLayout(),console.log("layout chainged")),l.openComment&&s.isEnable(i.prop.openComment)&&(r.openComment(s),console.log("comment opend")),l.changeMemberPageLayout&&s.pagetype===i.pagetype.member_illust){const e=document.getElementsByTagName("header")[0].nextElementSibling.children[0].children[0];document.getElementById("root").appendChild(e),console.log("layout chainged")}const e=document.getElementsByTagName("a");for(const t of e)t.addEventListener("click",()=>{let e=new o.Page(document.URL);if(console.log("pagetype:"+e.pagetype.toString()),l.changeIllustPageLayout&&e.isEnable(i.prop.changeIllustPageLayout)&&(a.Util.changeIllustPageLayout(),console.log("layout chainged.")),l.changeMemberPageLayout&&e.pagetype===i.pagetype.member_illust){const e=document.getElementsByTagName("header")[0].nextElementSibling.children[0].children[0];document.getElementById("root").appendChild(e)}l.openComment&&e.isEnable(i.prop.openComment)&&(r.openComment(e),console.log("comment opend."))})})}])}]);