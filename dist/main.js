!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=16)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContainerFactory=class{constructor(){this.id="",this.classname="",this.innerHtml="",this.innerText="",this.cssText=""}setId(e){return this.id=e,this}setClass(e){return this.classname=e,this}setLeft(e){}setTop(e){}setWitdh(e){return this.width=e,this}setInnerHtml(e){return this.innerHtml=e,this}setInnerText(e){return this.innerText=e,this}createDiv(){const e=document.createElement("div");return e.id=this.id,e.className=this.classname,e.innerHTML=this.innerHtml,e.style.cssText=this.cssText,this.init(),e}createImg(){const e=document.createElement("img");return e.id=this.id,e.className=this.classname,e.style.cssText=this.cssText,this.init(),e}createSpan(){const e=document.createElement("span");return e.id=this.id,e.className=this.classname,e.innerHTML=this.innerHtml,e.style.cssText=this.cssText,this.init(),e}appendChild(e){return this.appendChild(e),this}setCSS(e){return this.cssText=e,this}init(){this.id="",this.classname="",this.innerHtml="",this.innerText="",this.cssText=""}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ArtWork=class{constructor(){this.imgScale=.7}adjustScreenSize(e){const t=this.pixivJson.body.width,n=this.pixivJson.body.height;let i=t,o=n;if(n>window.innerHeight*e||t>window.innerWidth*e){const s=Number(window.innerHeight*e)/n,a=Number(window.innerWidth*e)/t;s<a?(o*=s,i*=s,this.imgScale=s):(o*=a,i*=a,this.imgScale=a)}const s=this.innerScreen;s.style.width=`${Math.round(i)}px`,s.style.height=`${Math.round(o)}px`}popup(e){}getOffset(e){const t=$(window).height(),n=$(window).width(),i=$(e).height(),o=$(e).width(),s=$(window).scrollTop()+(t-i)/2,a=(n-o)/2;return{top:Math.round(s),left:Math.round(a)}}set setScreenContainer(e){this.innerScreen=e}set setClassName(e){this.className=e}getClassName(){return this.className}set setImgScale(e){this.imgScale=e}getInnerScreen(){return this.innerScreen}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PixivJson=class{constructor(e){Object.assign(this,e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(4);t.Setting=class{constructor(){this.changeIllustPageLayout=!0,this.changeMemberPageLayout=!0,this.openComment=!0,this.usePopup=!0,this.popupCaption=!0,this.popupComment=!0,this.popupScale=.7,this.uiComponent=[i.uiComponent.image,i.uiComponent.manga,i.uiComponent.ugoira,i.uiComponent.caption]}async init(){await GM.getValue("pixiv_viewutil_setting").then(e=>{if(void 0!==e){const t=JSON.parse(e);this.changeIllustPageLayout=null==t.changeIllustPageLayout||t.changeIllustPageLayout,this.changeMemberPageLayout=null==t.changeMemberPageLayout||t.changeMemberPageLayout,this.openComment=null==t.openComment||t.openComment,this.usePopup=null==t.usePopup||t.usePopup,this.popupCaption=null==t.popupCaption||t.popupCaption,this.popupComment=null==t.popupComment||t.popupComment,this.popupScale=null==t.popupScale?.7:t.popupScale}})}set setStringData(e){const t=JSON.parse(e);this.setData(t)}set setData(e){this.changeIllustPageLayout=null==e.changeIllustPageLayout||e.changeIllustPageLayout,this.changeMemberPageLayout=null==e.changeMemberPageLayout||e.changeMemberPageLayout,this.openComment=null==e.openComment||e.openComment,this.usePopup=null==e.usePopup||e.usePopup,this.popupCaption=null==e.popupCaption||e.popupCaption,this.popupComment=null==e.popupComment||e.popupComment,this.popupScale=null==e.usePopup?.7:e.popupScale}get getJsonString(){const e={changeIllustPageLayout:this.changeIllustPageLayout,changeMemberPageLayout:this.changeMemberPageLayout,openComment:this.openComment,usePopup:this.usePopup,popupCaption:this.popupCaption,popupComment:this.popupComment,popupScale:this.popupScale};return JSON.stringify(e)}save(){GM.setValue("pixiv_viewutil_setting",this.getJsonString)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.changeIllustPageLayout=0]="changeIllustPageLayout",e[e.changeMemberPageLayout=1]="changeMemberPageLayout",e[e.popup_typeA=2]="popup_typeA",e[e.popup_typeB=3]="popup_typeB",e[e.openComment=4]="openComment"}(t.prop||(t.prop={})),function(e){e[e.image=0]="image",e[e.manga=1]="manga",e[e.ugoira=2]="ugoira",e[e.caption=3]="caption"}(t.uiComponent||(t.uiComponent={})),function(e){e[e.top=0]="top",e[e.bookmark_new_illust=1]="bookmark_new_illust",e[e.discovery=2]="discovery",e[e.member_illust=3]="member_illust",e[e.member=4]="member",e[e.bookmark_detail=5]="bookmark_detail",e[e.bookmark_add=6]="bookmark_add",e[e.ranking=7]="ranking",e[e.bookmark_id=8]="bookmark_id",e[e.search=9]="search",e[e.bookmark=10]="bookmark",e[e.other=11]="other"}(t.pagetype||(t.pagetype={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(4),o=n(3),s=n(0),a=n(2),r=n(14);class p{constructor(){this.settingIconID="pixiv-view-util-gear",this._iconElem=null,this.gearCSS="width: 25px; \n         height: 25px;\n         color:rgb(173, 173, 173);\n         ",this.modalCSS=".pixiv-modal {\n    display: none; /* Hidden by default */\n    position: fixed; /* Stay in place */\n    z-index:10000; /* Sit on top */\n    left: 0;\n    top: 0;\n    width: 100%; /* Full width */\n    height: 100%; /* Full height */\n    overflow: auto; /* Enable scroll if needed */\n    background-color: rgb(0,0,0); /* Fallback color */\n    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */\n}\n\n/* Modal Content/Box */\n#pixiv-modal-content {\n    background-color: #fefefe;\n    margin: 15% auto; /* 15% from the top and centered */\n    padding: 20px;\n    z-index:10001;\n    border: 1px solid #888;\n    width: 80%; /* Could be more or less, depending on screen size */\n}\n\n/* The Close Button */\n#pixiv-modal-close {\n    color: #aaa;\n    float: right;\n    font-size: 28px;\n    font-weight: bold;\n}\n\n#pixiv-modal-close :hover,\n#pixiv-modal-close :focus {\n    color: black;\n    text-decoration: none;\n    cursor: pointer;\n}\n"}async setIconElem(e){const t=await GM_getResourceText("gearIcon"),n=(new s.ContainerFactory).setId(e).setCSS(this.gearCSS).setInnerHtml(t).createDiv();n.className="trigger";const i=n.getElementsByTagName("svg")[0],o=n.getElementsByTagName("g")[0];i.setAttribute("width","25"),i.setAttribute("height","25"),o.setAttribute("fill","#BECAD8");const a=document.createElement("li");a.className="viewUtil",a.appendChild(n),document.body.getElementsByClassName("notifications")[0].appendChild(a)}async setConfigDialog(){const e=this.settingIconID;null===document.getElementById(this.settingIconID)&&(await this.setIconElem(e),await this.setModal(e))}async initExecute(e,t){t.pagetype==i.pagetype.top&&null===document.getElementById(this.settingIconID)&&this.setConfigDialog(),(e.usePopup&&t.isEnable(i.prop.popup_typeA)||t.isEnable(i.prop.popup_typeB))&&this.setPopup(t,e)}onloadExecute(e,t){if(t.pagetype===i.pagetype.top&&null===document.getElementById("pixiv-view-util-gear")&&this.setConfigDialog(),e.changeIllustPageLayout&&t.isEnable(i.prop.changeIllustPageLayout)&&(p.changeIllustPageLayout(),console.log("layout chainged")),e.openComment&&t.isEnable(i.prop.openComment)&&(this.openComment(t),console.log("comment opend")),e.changeMemberPageLayout&&(t.pagetype===i.pagetype.member||t.pagetype===i.pagetype.member_illust)){this.changeMemberPageLayout();for(let e=0;e<5;e++)setTimeout(this.changeMemberPageLayout(),1e3*e)}}static checkPageType(e){return e.match("https://www.pixiv.net/bookmark_new_illust.php?")?i.pagetype.bookmark_new_illust:e.match("https://www.pixiv.net/discovery?")?i.pagetype.discovery:e.match("https://www.pixiv.net/member_illust.php?")?i.pagetype.member_illust:e.match("https://www.pixiv.net/member.php?")?i.pagetype.member:e.match("https://www.pixiv.net/bookmark_detail.php?")?i.pagetype.bookmark_detail:e.match("https://www.pixiv.net/bookmark_add.php?")?i.pagetype.bookmark_add:e.match("https://www.pixiv.net/ranking.php?")?i.pagetype.ranking:e.match(/https:\/\/www\.pixiv\.net\/bookmark\.php\?id/)?i.pagetype.bookmark_id:e.match("https://www.pixiv.net/search.php")?i.pagetype.search:e.match("https://www.pixiv.net/bookmark.php?")?i.pagetype.bookmark:e.match("https://www.pixiv.net/")?i.pagetype.top:i.pagetype.other}static changeIllustPageLayout(){$("figure").before($("figcaption"))}static getAllowedFuncList(e){switch(e){case i.pagetype.top:return[i.prop.popup_typeB];case i.pagetype.bookmark_new_illust:case i.pagetype.discovery:return[i.prop.popup_typeA];case i.pagetype.member_illust:return[i.prop.popup_typeB,i.prop.changeIllustPageLayout,i.prop.openComment];case i.pagetype.member:return[i.prop.popup_typeB,i.prop.changeMemberPageLayout];case i.pagetype.bookmark_detail:case i.pagetype.bookmark_add:case i.pagetype.bookmark_id:return[i.prop.popup_typeB];case i.pagetype.search:return[i.prop.popup_typeA];case i.pagetype.ranking:case i.pagetype.bookmark:return[i.prop.popup_typeB];default:return[]}}openComment(e){if(e.getURL.indexOf("mode=medium")>0){let e=$("article");e.find("[aria-expanded='false']").click(),new MutationObserver(function(t,n){e.find("[aria-expanded='false']").click()}).observe(document,{childList:!0,subtree:!0})}}setPopup(e,t){const n=new r.PopupScreen(e,t);$("body").on("mouseenter",'a[href*="member_illust.php?mode=medium&illust_id="]',function(){const e=$(this).find(".non-trim-thumb"),i=e.length>0?e[0]:this;$(this).attr("onclick","console.log();return false;"),$(this).find(".non-trim-thumb").attr("onclick","console.log();return false;");const o=this,s=this.getAttribute("href").match(/(.)+illust_id=([0-9]+)(&.+)?/),r=Number(s[2]);$(i).on("click",async function(e){await fetch(`https://www.pixiv.net/ajax/illust/${r}`,{method:"GET",mode:"cors",keepalive:!0}).then(function(e){if(e.ok)return e.json()}).then(async function(e){const i=new a.PixivJson(e);n.setPixivJson(i),n.popupArtwork($(o).hasClass("on")),t.popupComment&&n.popupComment(),t.popupCaption&&n.popupCaption(),n.isUgoira()&&await fetch(`https://www.pixiv.net/ajax/illust/${i.body.illustId}/ugoira_meta`).then(function(e){return e.json()}).then(async e=>{await n.popupUgoira(new a.PixivJson(e))})}).then(()=>{n.adjustSize(),n.adjustOffset(),n.addMouseMove()})})})}setModal(e){const t=new o.Setting,n=document.getElementById(e),i=document.createElement("div");i.innerHTML='  \n<div id="myModal" class="pixiv-modal">\n  <div id="pixiv-modal-content" >\n    <span id="pixiv-modal-close" >OK</span>\n    <p>Setting:</p>\n    <div id="pixiv-set-IllustPageLayout">\n    Modify the illust page\'s layout\n        <input type="radio"  name=\'pixivutil-setting1\' id="pixivutil-setting1-yes" value="1"  />\n        <label for="dummy_1" data-label="ON">ON</label>\n        <input type="radio"  name=\'pixivutil-setting1\' id="pixivutil-setting1-no" value="0"  checked  />\n        <label for="dummy_0" data-label="OFF">OFF</label>\n    </div>\n    <div id="pixiv-set-MemberPageLayout">\n     Modify the author page\'s layout\n        <input type="radio"  name=\'pixivutil-setting2\' id="pixivutil-setting2-yes" value="1"  />\n        <label for="dummy_1" data-label="ON">ON</label>\n        <input type="radio"  name=\'pixivutil-setting2\' id="pixivutil-setting2-no" value="0" checked   />\n        <label for="dummy_0" data-label="OFF">OFF</label>\n    </div>\n    <div id="pixiv-set-Popup">\n     Use popup function\n        <input type="radio"  name=\'pixivutil-setting3\' id="pixivutil-setting3-yes" value="1" />\n        <label for="dummy_1" data-label="ON">ON</label>\n        <input type="radio"  name=\'pixivutil-setting3\' id="pixivutil-setting3-no" value="0"  checked   />\n        <label for="dummy_0" data-label="OFF">OFF</label>\n    </div>\n    <div id="pixiv-set-PopupCaption">\n     Popup caption\n        <input type="radio"  name=\'pixivutil-setting4\' id="pixivutil-setting4-yes" value="1"/>\n        <label for="dummy_1" data-label="ON">ON</label>\n        <input type="radio"  name=\'pixivutil-setting4\' id="pixivutil-setting4-no" value="0" checked  />\n        <label for="dummy_0" data-label="OFF">OFF</label>\n    </div>\n        <div id="pixiv-set-PopupComment">\n     Popup Comment\n        <input type="radio"  name=\'pixivutil-setting5\' id="pixivutil-setting5-yes" value="1"/>\n        <label for="dummy_1" data-label="ON">ON</label>\n        <input type="radio"  name=\'pixivutil-setting5\' id="pixivutil-setting5-no" value="0" checked  />\n        <label for="dummy_0" data-label="OFF">OFF</label>\n    </div>\n    <div >\n    Popup size (min <-> max)\n      <input type="range" value="0.7" min="0.3" max="1.2" step="0.1" id="pixiv-set-Scale" />\n    </div>\n  </div>\n</div>\n\t',document.body.appendChild(i);const s=document.createElement("style");s.textContent=this.modalCSS,document.getElementsByTagName("head")[0].appendChild(s);const a=document.getElementById("myModal"),r=document.getElementById("pixiv-modal-close");n.onclick=(()=>a.style.display="block");const p=document.getElementsByName("pixivutil-setting1")[0],l=document.getElementsByName("pixivutil-setting2")[0],c=document.getElementsByName("pixivutil-setting3")[0],h=document.getElementsByName("pixivutil-setting4")[0],u=document.getElementsByName("pixivutil-setting5")[0],m=document.getElementById("pixiv-set-Scale");t.init().then(()=>{t.changeIllustPageLayout&&!p.checked&&(p.checked=!0),t.changeMemberPageLayout&&!l.checked&&(l.checked=!0),t.usePopup&&!c.checked&&(c.checked=!0),t.popupCaption&&!h.checked&&(h.checked=!0),t.popupComment&&!u.checked&&(u.checked=!0),m.value=String(t.popupScale)}),r.onclick=(()=>{a.style.display="none",t.changeIllustPageLayout=p.checked,t.changeMemberPageLayout=l.checked,t.usePopup=c.checked,t.popupCaption=h.checked,t.popupComment=u.checked,t.popupScale=m.value,t.save()}),window.onclick=function(e){e.target==a&&(a.style.display="none")}}changeMemberPageLayout(){const e=document.getElementsByTagName("h2");if(void 0!==e)for(const t of e)if(t.innerText.startsWith("イラスト")){const e=t.parentElement.parentElement,n=document.getElementsByTagName("header")[0];n.parentNode.insertBefore(e,n.nextSibling);break}}}t.Util=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);t.Screen=class{constructor(e,t){this.screenContinerID="popup-screen-container",this.screenContainer=(new i.ContainerFactory).setId(this.screenContinerID).setClass(e).setCSS(this.screenContainerCSS(t)).createDiv()}screenContainerCSS(e){return`\n        border: 5px solid black;\n        background-color:#111;\n        position:relative;\n        width:auto;\n        height:auto;\n        float:left;\n        max-width:${window.innerWidth}px;\n        max-height:${window.innerHeight}px;\n        `}getContainer(){return this.screenContainer}resetContainer(){this.screenContainer=document.getElementById(this.screenContinerID)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);t.CommentClass=class{constructor(e){this.commentContainerCSS="\n      background:#EEEEEE;\n      margin: 5px;\n    ",this.emoji={"(normal)":101,"(surprise)":102,"(serious)":103,"(heaven)":104,"(happy)":105,"(excited)":106,"(sing)":107,"(cry)":108,"(normal2)":201,"(shame2)":202,"(love2)":203,"(interesting2)":204,"(blush2)":205,"(fire2)":206,"(angry2)":207,"(shine2)":208,"(panic2)":209,"(normal3)":301,"(satisfaction3)":302,"(surprise3)":303,"(smile3)":304,"(shock3)":305,"(gaze3)":306,"(wink3)":307,"(happy3)":308,"(excited3)":309,"(love3)":310,"(normal4)":401,"(surprise4)":402,"(serious4)":403,"(love4)":404,"(shine4)":405,"(sweat4)":406,"(shame4)":407,"(sleep4)":408,"(heart)":501,"(teardrop)":502,"(star)":503},Object.assign(this,e)}toElem(){const e=(new i.ContainerFactory).setCSS(this.commentContainerCSS).createDiv(),t=(new i.ContainerFactory).createDiv();return t.appendChild(this.getMainComment()),e.appendChild(t),e.appendChild(this.getCommentInfo()),e}getMainComment(){const e=document.createElement("div");return this.stampId?(e.style.backgroundImage=`url("https://s.pximg.net/common/images/stamp/generated-stamps/${this.stampId}_s.jpg?20180605")`,e.style.width="48px",e.style.height="48px",e.style.backgroundRepeat="no-repeat",e.style.backgroundSize="cover",e.style.borderRadius="2px",e):(e.innerHTML=this.getEmoji(this.comment),e)}getCommentInfo(){const e=document.createElement("div");return e.innerHTML=`${this.userName}</br> ${this.commentDate}`,e.style.fontSize="xx-small",e.style.textAlign="left",e.style.color="#999999",e}getEmoji(e){const t=this.emoji;if(e.includes(")")){let n=e;return Object.keys(t).forEach(function(e){n=n.replace(e,`<span style="width: 12px; height: 12px; display: inline-block; background-image: url('https://s.pximg.net/common/images/emoji/${t[e]}.png'); background-size: contain;"></span>`)}),n}return e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(2),o=n(7),s=n(0);t.CommentList=class{constructor(e){this.commentOffset=0,this.commentLimit=25,this.MAXWIDTH=200,this.commentListContainerID="popup-commentlist-container",this.commentListContainerCSS=`\n        white-space:pre-wrap;\n        z-index:10001;\n        width:auto;\n        height:auto;\n        display:none;\n        overflow-y:scroll;\n        background-color:white;\n        border: 1px solid #000;\n        max-width:${this.MAXWIDTH}px;\n        max-height:${window.innerHeight}px;\n        `,this.commentListContainer=(new s.ContainerFactory).setId(this.commentListContainerID).setClass(e).setCSS(this.commentListContainerCSS).createDiv()}async init(){this.commentOffset=0,this.commentListContainer.innerHTML="";const e=[];if(0!==this.commentNum){const t=`https://www.pixiv.net/ajax/illusts/comments/roots?illust_id=${this.pixivJson.body.illustId}&offset=${this.commentOffset}&limit=${this.commentLimit}`;await fetch(t,{method:"GET",mode:"cors",keepalive:!0}).then(function(e){if(e.ok)return e.json()}).then(async function(t){const n=new i.PixivJson(t).body.comments;for(let t of n){const n=new o.CommentClass(t);e.push(n)}})}this.commentList=e}setClassName(e){this.className=e}popup(){const e=this.commentListContainer,t=this.commentList;e.innerHTML="",e.style.display="inline-block",e.style.width="100px";for(const n of t)e.appendChild(n.toElem());const n=this.commentNum;this.commentOffset,e.onscroll=(()=>{let i=e.scrollTop+e.clientHeight,o=e.scrollHeight;this.commentOffset<n&&i/o>=.8&&(this.commentList=t,this.commentOffset+=this.commentLimit,console.log(`comment reload ${this.commentOffset}`),this.appendComment())})}async appendComment(){const e=this.commentListContainer,t=`https://www.pixiv.net/ajax/illusts/comments/roots?illust_id=${this.pixivJson.body.illustId}&offset=${this.commentOffset}&limit=${this.commentLimit}`;await fetch(t,{method:"GET",mode:"cors",keepalive:!0}).then(function(e){if(e.ok)return e.json()}).then(async function(t){const n=new i.PixivJson(t).body.comments;for(let t of n){const n=new o.CommentClass(t);e.appendChild(n.toElem())}})}adjustSize(e){this.commentListContainer.style.height=`${e.offsetHeight}px`}setCommentListContainer(e){this.commentListContainer.innerText="",this.commentListContainer=e}setJson(e){this.pixivJson=e,this.commentNum=e.body.commentCount}setOuterContainer(e){this.outerContainer=e}getContainer(){return this.commentListContainer}resetContainer(){this.commentListContainer=document.getElementById(this.commentListContainerID)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);t.Caption=class{constructor(e){this.captionContainerID="popup-caption-container",this.captionDescriptionID="popup-caption-text",this.captionTagID="popup-caption-tag",this.captionDateID="popup-caption-date",this.captionLikeID="popup-caption-like",this.captionBookmarkID="popup-caption-bookmark",this.captionViewID="popup-caption-view",this.captionInfoID="popup-caption-infomation",this.likeIcon='<img src="https://s.pximg.net/www/js/spa/260127df5fe9ade778ec4be463deaf01.svg" width="12" height="12">',this.bookmarkIcon='<svg viewBox="0 0 12 12" width="12" height="12" class="css-1hamw6p e1rs6xf14"><path fill="currentColor" d="\n        M9,0.75 C10.6568542,0.75 12,2.09314575 12,3.75 C12,6.68851315 10.0811423,9.22726429 6.24342696,11.3662534\n        L6.24342863,11.3662564 C6.09210392,11.4505987 5.90790324,11.4505988 5.75657851,11.3662565\n        C1.9188595,9.22726671 0,6.68851455 0,3.75 C1.1324993e-16,2.09314575 1.34314575,0.75 3,0.75\n        C4.12649824,0.75 5.33911281,1.60202454 6,2.66822994 C6.66088719,1.60202454 7.87350176,0.75 9,0.75 Z"></path></svg>',this.viewIcon='<img src="https://s.pximg.net/www/js/spa/af74d092363c09fd06441a4ab04c9331.svg" width="14" height="12">',this.captionContainerCSS=`\n        white-space:pre-wrap;\n        z-index:10001;\n        position:relative;\n        width:auto;\n        height:auto;\n        border: 1px solid #000;\n        max-width:${window.innerWidth}px;\n        max-height:${window.innerHeight}px;\n        background-color:white;\n        word-wrap:break-word;\n       word-break:break-all;\n        \n       `,this.pixpediaItemCSS=".popup-pixpedia-icon{\n    display: inline-block;\n    margin-left: 2px;\n    width: 15px;\n    height: 14px;\n    vertical-align: -2px;\n    text-decoration: none;\n    background: url(https://s.pximg.net/www/images/inline/pixpedia.png) no-repeat;\n    }\n.popup-pixpedia-no-icon{\n    display: inline-block;\n    margin-left: 2px;\n    width: 15px;\n    height: 14px;\n    vertical-align: -2px;\n    text-decoration: none;\n     background: url(https://s.pximg.net/www/images/inline/pixpedia-no-item.png) no-repeat;\n}\n     ",this.descriptionContainerCSS="font-size: normal; \n          width: auto; \n          height:auto;\n          overflow-y:scroll;",this.infoContainerCSS="\n        background-color:white;\n        font-size:xx-small;\n        width: auto;\n        color:#999999; \n        line-height=1;",this.captionContainer=(new i.ContainerFactory).setId(this.captionContainerID).setClass(e).setCSS(this.captionContainerCSS).createDiv()}popup(){const e=this.captionContainer,t=this.pixivJson;e.innerText="";const n=new i.ContainerFactory,o=n.setId(this.captionDescriptionID).setClass(this.className).setCSS(this.descriptionContainerCSS).setInnerHtml(t.body.description).createDiv(),s=n.setId(this.captionTagID).setClass(this.className).createDiv();s.appendChild(this.getTagHtml(t));const a=new Date(t.body.createDate),r=`upload:${a.getFullYear()}/${a.getMonth()+1}/${a.getDate()} ${a.getHours()}:${String(a.getMinutes()).padStart(2,"0")}`,p=n.setId(this.captionDateID).setInnerHtml(r).createDiv(),l=`${this.likeIcon} ${t.body.likeCount} `,c=n.setId(this.captionLikeID).setClass(this.className).setInnerHtml(l).createSpan(),h=`${this.bookmarkIcon} ${t.body.bookmarkCount} `,u=n.setId(this.captionBookmarkID).setClass(this.className).setInnerHtml(h).createSpan(),m=`${this.viewIcon}${t.body.viewCount}`,d=n.setId(this.captionViewID).setClass(this.className).setInnerHtml(m).createSpan(),g=n.setId(this.captionInfoID).setClass(this.className).setCSS(this.infoContainerCSS).createDiv();g.appendChild(p),g.appendChild(c),g.appendChild(u),g.appendChild(d),e.appendChild(o),e.appendChild(s),e.appendChild(g),this.descriptionElem=o,this.tagElem=s,this.infoElem=g,e.style.display="block"}getTagHtml(e){let t=document.createElement("ul");t.style.paddingInlineStart="0px";for(const n of e.body.tags.tags){let e=document.createElement("a");e.className=`${n.romaji||n.locked?"popup-pixpedia-icon":"popup-pixpedia-no-icon"}`,e.setAttribute("href",`https://dic.pixiv.net/a/${n.tag}`);let i=document.createElement("li");i.innerHTML=` ${n.locked?"<span>＊<span>":""}${n.tag}`,i.style.cssText="display: inline-block;",i.appendChild(e),t.appendChild(i)}return t}setClassName(e){this.className=e}adjustSize(e){this.descriptionElem.style.height=this.descriptionElem.clientHeight>100?"100px":`${this.descriptionElem.clientHeight}px`,this.captionContainer.style.width=`${e.offsetWidth}px`}setJson(e){this.pixivJson=e}setCaptionContainer(e){this.captionContainer=e}getContainer(){return this.captionContainer}addCSS(){const e=document.createElement("style");e.textContent=this.pixpediaItemCSS,document.getElementsByTagName("head")[0].appendChild(e)}resetContainer(){this.captionContainer=document.getElementById(this.captionContainerID),this.captionContainer.innerText=""}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Frame=class{constructor(){this.imgArray=[],this._imgStringArray=[],this._frameArray=[]}pushDelay(e){this._frameArray.push(e)}pushImgString(e){this._imgStringArray.push(e)}get imgStringArray(){return this._imgStringArray}set imgStringArray(e){this._imgStringArray=e}set frameArray(e){this._frameArray=e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(10),o=n(0);class s{constructor(e,t){this.ugoiraContainerID="popup-ugoira",this.pixivJson=e,this.ugoiraMetaJson=t}async init(){const e=this.innerContainer;let t=!1;new o.ContainerFactory;e.textContent=null;const n=document.createElement("canvas");n.id=this.ugoiraContainerID,n.className=this.className,this.ugoiraContainer=n,e.appendChild(n);let s=new Headers;s.append("Accept-Encoding","gzip, deflate, br"),s.append("Connection","keep-alive"),s.append("HOST","www.pixiv.net");let a=new JSZip;const r=this.ugoiraMetaJson.body.frames,p=new i.Frame;await fetch(this.ugoiraMetaJson.body.src,{method:"GET",headers:s,mode:"cors",keepalive:!0}).then(e=>{if(e.ok)return e.blob()}).then(async e=>{await a.loadAsync(e,{base64:!0})}).then(()=>{for(let e=0;e<r.length;e++)a.file(r[e].file).async("base64",function(e){100===e.percent&&(t=!0)}).then(function(e){p.pushImgString(`data:image/jpeg;base64,${e}`)},function(e){console.log("download error.")})}).then(()=>{this.frameData=p})}setScreenContainer(e){this.innerContainer=e}resize(e,t){const n=this.pixivJson.body.width,i=this.pixivJson.body.height;let o=n,s=i;if(i>window.innerHeight*t||n>window.innerWidth*t){const e=i/Number(window.innerHeight*t),a=n/Number(window.innerWidth*t);e>a?(s/=e,o/=e):(s/=a,o/=a)}this.ugoiraContainer.width=o,this.ugoiraContainer.height=s,e.style.width=`${Math.round(o)}px`,e.style.height=`${Math.round(s)}px`}popup(e){this.frameData.frameArray;const t=this.frameData.imgStringArray,n=new Image;let i=0;const o=()=>{n.src=t[i],this.ugoiraContainer.getContext("2d").drawImage(n,0,0,this.ugoiraContainer.clientWidth,this.ugoiraContainer.clientHeight),"none"!==e.style.display&&(setTimeout(o,this.ugoiraMetaJson.body.frames[i].delay),i=(i+=1)===t.length?0:i)};o()}setClassName(e){this.className=e}}s.imgArray=[],s.imgStringArray=[],t.Ugoira=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),o=n(1);t.Illust=class extends o.ArtWork{constructor(e,t,n){super(),this.illustContainerID="popup-img",this.illustContainerCSS="width: 100%; \n          height:100%;\n          display:none;\n          left: 0;\n          top: 0;\n          background-size: contain;\n          background-position:center; \n          background-repeat:no-repeat;\n            ",this.pixivJson=n,this.innerContainer=t,this.innerContainer.innerHTML="";const o=new i.ContainerFactory;this.illustContainer=o.setId(this.className).setClass(this.className).setCSS(this.illustContainerCSS).createDiv();const s=this.illustContainer;t.appendChild(s),this.innerContainer.appendChild(s),s.style.display="none",s.style.backgroundImage=`url(${this.pixivJson.body.urls.regular})`,s.style.left="0",s.style.top="0",s.style.width="100%",s.style.height="100%",s.style.backgroundSize="contain",s.style.backgroundPosition="center",s.style.backgroundRepeat="no-repeat"}popup(e){this.innerContainer.style.backgroundColor=e?"rgb(255, 64, 96)":"rgb(34, 34, 34)",this.illustContainer.style.display="block"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),o=n(1);t.Manga=class extends o.ArtWork{constructor(e){super(),this.mangaContainerID="popup-manga",this.pageNum=0,this.mangaContainerCSS=" background-color:black;\n           overflow-x:auto;\n           white-space:nowrap;\n           width: 100%; \n           height:auto;\n           top:0;\n           left:0;\n            ",this.pixivJson=e,this.pageNum=this.getPageNum(e),this.imgArray=new Array(this.pageNum);const t=new i.ContainerFactory;this.mangaContainer=t.setId(this.mangaContainerID).setClass(this.className).setCSS(this.mangaContainerCSS).createDiv(),this.DELTASCALE="mozInnerScreenX"in window?70:4}adjustScreenSize(e){const t=this.innerScreen;t.style.width=`${window.innerWidth*e}px`,t.style.height=`${window.innerHeight*e}px`}popup(e){this.innerScreen.style.display="block",this.innerScreen.style.width=`${Number(this.innerScreen.style.maxWidth)*this.imgScale}px`,this.innerScreen.style.height=`${Number(this.innerScreen.style.maxHeight)*this.imgScale}px`,this.innerScreen.innerHTML="",this.innerScreen.style.backgroundColor=e?"rgb(255, 64, 96)":"rgb(34, 34, 34)";const t=this.getImgUrl();this.initImgArray(this.mangaContainer,t),this.innerScreen.appendChild(this.mangaContainer),this.setScrool(this.mangaContainer,this.innerScreen,this.DELTASCALE)}initImgArray(e,t){for(let n=0;n<this.pageNum;n++){const i=document.createElement("img");i.src=t.replace("p0","p"+n),i.style.maxWidth=this.innerScreen.style.width,i.style.maxHeight=this.innerScreen.style.height,i.style.height=this.innerScreen.style.height,i.style.width="auto",this.imgArray.push(i),e.appendChild(i)}}setScrool(e,t,n){this.mangaContainer.onwheel=function(i){i.deltaY<0&&t.getBoundingClientRect().top<0?t.scrollIntoView({block:"start",behavior:"smooth"}):i.deltaY>0&&t.getBoundingClientRect().bottom>document.documentElement.clientHeight&&t.scrollIntoView({block:"end",behavior:"smooth"});let o=e.scrollLeft;(o>0&&i.deltaY<0||o<e.scrollWidth-e.clientWidth&&i.deltaY>0)&&(i.preventDefault(),e.scrollLeft+=i.deltaY*n)}}getImgUrl(){return this.pixivJson.body.urls.regular.replace(/\/...x...\//,"/600x600/")}getPageNum(e){return Number(e.body.pageCount)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),o=n(13),s=n(12),a=n(11),r=n(9),p=n(8),l=n(6);t.PopupScreen=class{constructor(e,t){if(this.outerContainerID="popup-outer-container",this.captionMaxHeight=100,this.popupClass="popup-util",this.outerContainerCSS="\n        position:absolute;\n        z-index:10000;\n        ",this.page=e,this.setting=t,null===document.getElementById(this.outerContainerID)){const e=new i.ContainerFactory;this.outerContainer=e.setId(this.outerContainerID).setClass(this.popupClass).setCSS(this.outerContainerCSS).createDiv(),this.screen=new l.Screen(this.popupClass,this.popupScale),this.caption=new r.Caption(this.popupClass),this.caption.addCSS(),this.commentList=new p.CommentList(this.popupClass),this.outerContainer.appendChild(this.caption.getContainer()),this.outerContainer.appendChild(this.screen.getContainer()),this.outerContainer.appendChild(this.commentList.getContainer()),document.body.appendChild(this.outerContainer)}else this.outerContainer=document.getElementById(this.outerContainerID),this.cleanOuterContainer(),this.screen.resetContainer(),this.caption.resetContainer(),this.commentList.resetContainer();this.outerContainer.style.display="none"}popupArtwork(e){this.outerContainer.style.display="block";const t=this.isManga()?new o.Manga(this.pixivJson):new s.Illust(this.page,this.screen.getContainer(),this.pixivJson);this.artwork=t,t.setScreenContainer=this.screen.getContainer(),t.setClassName=this.popupClass,t.adjustScreenSize(this.setting.popupScale),t.popup(e)}async popupUgoira(e){const t=new a.Ugoira(this.pixivJson,e);t.setClassName(this.popupClass),await t.init().then(()=>{t.resize(this.outerContainer,this.setting.popupScale),t.popup(this.outerContainer)})}async popupCaption(){const e=this.caption;e.setJson(this.pixivJson),await e.popup(),e.adjustSize(this.screen.getContainer())}async popupComment(){const e=this.commentList;e.setJson(this.pixivJson),e.setOuterContainer(this.outerContainer),e.setClassName(this.popupClass),await e.init().then(()=>{e.popup(),e.adjustSize(this.screen.getContainer())})}setPixivJson(e){this.pixivJson=e}isIllust(){return 0===this.pixivJson.body.illustType}isManga(){return 1===this.pixivJson.body.illustType||this.pixivJson.body.pageCount&&Number(this.pixivJson.body.pageCount)>1}isUgoira(){return 2===this.pixivJson.body.illustType}addMouseMove(){const e=this.outerContainer;let t=0,n=0,i=0,o=0,s=!1;const a=a=>{s=!0,(a=a||window.event).preventDefault(),t=i-a.clientX,n=o-a.clientY,i=a.clientX,o=a.clientY,e.style.top=e.offsetTop-n+"px",e.style.left=e.offsetLeft-t+"px"},r=()=>{document.onmouseup=null,document.onmousemove=null,s||this.cleanOuterContainer(),s=!1};e.onmousedown=(t=>{(t=t||window.event).offsetX<=t.target.clientWidth&&t.offsetY<=t.target.clientHeight&&0===t.button&&(t.preventDefault(),i=t.clientX,o=t.clientY,document.onmouseup=r,document.onmousemove=a,e.onmouseleave=(()=>{this.cleanOuterContainer()}))}),this.setting,this.outerContainer,window.onresize=function(){}}removePopup(){this.removeContainer(this.outerContainer)}cleanOuterContainer(){this.screen.getContainer().innerText="",this.caption.getContainer().innerText="",this.commentList.getContainer().innerText="",this.outerContainer.style.display="none"}removeContainer(e){e.innerText="",e.parentNode.removeChild(e)}getOffset(e){const t=window.innerHeight,n=window.innerWidth,i=e.offsetHeight,o=e.offsetWidth,s=window.scrollY+(t-i)/2,a=(n-o)/2;return{top:Math.round(s),left:Math.round(a)}}adjustOffset(){const e=this.outerContainer,t=this.getOffset(e);e.style.left=`${t.left}px`,e.style.top=`${t.top}px`}adjustSize(){this.caption.getContainer().style.width=`${this.screen.getContainer().offsetWidth}px`,this.outerContainer.style.width=`${this.screen.getContainer().offsetWidth+this.commentList.MAXWIDTH}px`,this.outerContainer.style.height=`${this.caption.getContainer().offsetHeight+this.screen.getContainer().offsetHeight}px`}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(5);t.Page=class{constructor(e){this.URL=e,this.pagetype=i.Util.checkPageType(e),this.siteImgMaxWidth=500,this.alloedFunclist=i.Util.getAllowedFuncList(this.pagetype),this.imgSelector='a[href*="member_illust.php?mode=medium&illust_id="]',this.mangaSelector='a[href*="member_illust.php?mode=medium&illust_id="] > div:nth-child(2) '}set setURL(e){this.URL=e,this.pagetype=i.Util.checkPageType(e)}get getURL(){return this.URL}get getFunclist(){return this.alloedFunclist}isEnable(e){return this.alloedFunclist.indexOf(e)>-1}get getPagetype(){return this.pagetype}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(15),o=n(5),s=n(3),a=new i.Page(document.URL),r=new o.Util,p=new s.Setting;p.init().then(()=>{r.initExecute(p,a)}),window.onload=(()=>{console.log("pagetype:"+a.pagetype.toString()),r.onloadExecute(p,a);const e=document.getElementsByTagName("a");for(const t of e)t.addEventListener("click",()=>{r.onloadExecute(p,new i.Page(document.URL))});p.save()})}])}]);