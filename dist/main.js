!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.changeIllustPageLayout=0]="changeIllustPageLayout",e[e.changeMemberPageLayout=1]="changeMemberPageLayout",e[e.popup_typeA=2]="popup_typeA",e[e.popup_typeB=3]="popup_typeB",e[e.openComment=4]="openComment"}(t.prop||(t.prop={})),function(e){e[e.image=0]="image",e[e.manga=1]="manga",e[e.caption=2]="caption"}(t.uiComponent||(t.uiComponent={})),function(e){e[e.top=0]="top",e[e.bookmark_new_illust=1]="bookmark_new_illust",e[e.discovery=2]="discovery",e[e.member_illust=3]="member_illust",e[e.member=4]="member",e[e.bookmark_detail=5]="bookmark_detail",e[e.bookmark_add=6]="bookmark_add",e[e.ranking=7]="ranking",e[e.bookmark_id=8]="bookmark_id",e[e.search=9]="search",e[e.bookmark=10]="bookmark",e[e.other=11]="other"}(t.pagetype||(t.pagetype={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);t.Setting=class{constructor(){this.changeIllustPageLayout=!0,this.changeMemberPageLayout=!0,this.openComment=!0,this.popup=!0}async init(){await GM.getValue("pixiv_viewutil_setting").then(e=>{if(void 0!==e){const t=JSON.parse(e);this.changeIllustPageLayout=null==t.changeIllustPageLayout||t.changeIllustPageLayout,this.changeMemberPageLayout=null==t.changeMemberPageLayout||t.changeMemberPageLayout,this.openComment=null==t.openComment||t.openComment,this.popup=null==t.popup||t.popup}})}set setStringData(e){const t=JSON.parse(e);this.changeIllustPageLayout=null==t.changeIllustPageLayout||t.changeIllustPageLayout,this.changeMemberPageLayout=null==t.changeMemberPageLayout||t.changeMemberPageLayout,this.openComment=null==t.openComment||t.openComment,this.popup=null==t.popup||t.popup,this.uiComponent=[i.uiComponent.image,i.uiComponent.manga,i.uiComponent.caption]}set setData(e){this.changeIllustPageLayout=null==e.changeIllustPageLayout||e.changeIllustPageLayout,this.changeMemberPageLayout=null==e.changeMemberPageLayout||e.changeMemberPageLayout,this.openComment=null==e.openComment||e.openComment,this.popup=null==e.popup||e.popup}get getJsonString(){const e={changeIllustPageLayout:this.changeIllustPageLayout,changeMemberPageLayout:this.changeMemberPageLayout,openComment:this.openComment,popup:this.popup};return JSON.stringify(e)}save(){GM.setValue("pixiv_viewutil_setting",this.getJsonString)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContainerFactory=class{constructor(){this.id="",this.innerHtml="",this.innerText="",this.cssText=""}setId(e){return this.id=e,this}setLeft(e){}setTop(e){}setWitdh(e){return this.width=e,this}setInnerHtml(e){return this.innerHtml=e,this}setInnerText(e){return this.innerText=e,this}createDiv(){const e=document.createElement("div");return e.id=this.id,e.innerHTML=this.innerHtml,e.style.cssText=this.cssText,e}createImg(){const e=document.createElement("img");return e.id=this.id,e.style.cssText=this.cssText,e}setVoidHtml(){return this.innerHtml="",this}createSpan(){const e=document.createElement("span");return e.id=this.id,e.innerHTML=this.innerHtml,e.style.cssText=this.cssText,e}appendChild(e){return this.appendChild(e),this}setCSS(e){return this.cssText=e,this}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),o=n(6),a=n(1),s=n(2),l=n(4);class p{constructor(){this.outerContainerCSS=`\n        position:absolute;\n        display:block;\n        z-index:1000;\n        border: 5px solid black;\n        max-width:${.8*window.innerWidth}px;\n        background-color:#111;\n        max-width:${.8*window.innerWidth}px;\n        max-height:${.8*window.innerHeight}px;\n        `,this.gearCSS="width: 25px; \n         height: 25px;\n         color:rgb(173, 173, 173);\n         ",this.modalCSS=".pixiv-modal {\n    display: none; /* Hidden by default */\n    position: fixed; /* Stay in place */\n    z-index:10000; /* Sit on top */\n    left: 0;\n    top: 0;\n    width: 100%; /* Full width */\n    height: 100%; /* Full height */\n    overflow: auto; /* Enable scroll if needed */\n    background-color: rgb(0,0,0); /* Fallback color */\n    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */\n}\n\n/* Modal Content/Box */\n#pixiv-modal-content {\n    background-color: #fefefe;\n    margin: 15% auto; /* 15% from the top and centered */\n    padding: 20px;\n    z-index:10001;\n    border: 1px solid #888;\n    width: 80%; /* Could be more or less, depending on screen size */\n}\n\n/* The Close Button */\n#pixiv-modal-close {\n    color: #aaa;\n    float: right;\n    font-size: 28px;\n    font-weight: bold;\n}\n\n#pixiv-modal-close :hover,\n#pixiv-modal-close :focus {\n    color: black;\n    text-decoration: none;\n    cursor: pointer;\n}\n        "}async initExecute(e,t){if(t.pagetype==i.pagetype.top&&null===document.getElementById("pixiv-view-util-gear")&&this.setConfigScreen(),e.popup&&t.isEnable(i.prop.popup_typeA)?(this.setPopup(t,e),console.log("set popup typeA")):e.popup&&t.isEnable(i.prop.popup_typeB)&&(this.setPopup(t,e),console.log("set popup typeB")),e.changeMemberPageLayout&&t.isEnable(i.prop.changeMemberPageLayout)){const e=document.getElementsByTagName("header")[0].nextElementSibling.children[0].children[0];document.getElementById("root").appendChild(e),console.log("layout chainged")}}onloadExecute(e,t){if(t.pagetype===i.pagetype.top&&null===document.getElementById("pixiv-view-util-gear")&&this.setConfigScreen(),e.changeIllustPageLayout&&t.isEnable(i.prop.changeIllustPageLayout)&&(p.changeIllustPageLayout(),console.log("layout chainged")),e.openComment&&t.isEnable(i.prop.openComment)&&(this.openComment(t),console.log("comment opend")),e.changeMemberPageLayout&&t.pagetype===i.pagetype.member_illust){const e=document.getElementsByTagName("header")[0].nextElementSibling.children[0].children[0];document.getElementById("root").appendChild(e),console.log("layout chainged")}}static checkPageType(e){return e.match("https://www.pixiv.net/bookmark_new_illust.php?")?i.pagetype.bookmark_new_illust:e.match("https://www.pixiv.net/discovery?")?i.pagetype.discovery:e.match("https://www.pixiv.net/member_illust.php?")?i.pagetype.member_illust:e.match("https://www.pixiv.net/member.php?")?i.pagetype.member:e.match("https://www.pixiv.net/bookmark_detail.php?")?i.pagetype.bookmark_detail:e.match("https://www.pixiv.net/bookmark_add.php?")?i.pagetype.bookmark_add:e.match("https://www.pixiv.net/ranking.php?")?i.pagetype.ranking:e.match(/https:\/\/www\.pixiv\.net\/bookmark\.php\?id/)?i.pagetype.bookmark_id:e.match("https://www.pixiv.net/search.php")?i.pagetype.search:e.match("https://www.pixiv.net/bookmark.php?")?i.pagetype.bookmark:e.match("https://www.pixiv.net/")?i.pagetype.top:i.pagetype.other}static changeIllustPageLayout(){$("figure").before($("figcaption"))}static changeMemberPageLayout(){const e=$("h2");for(const t of e)if(t.innerText.startsWith("イラスト")){const e=$(t).parent().parent();$("header").next().prepend(e);break}}static getAllowedFuncList(e){switch(e){case i.pagetype.top:return[i.prop.popup_typeB];case i.pagetype.bookmark_new_illust:case i.pagetype.discovery:return[i.prop.popup_typeA];case i.pagetype.member_illust:return[i.prop.popup_typeB,i.prop.changeIllustPageLayout,i.prop.openComment];case i.pagetype.member:return[i.prop.popup_typeB,i.prop.changeMemberPageLayout];case i.pagetype.bookmark_detail:case i.pagetype.bookmark_add:case i.pagetype.bookmark_id:return[i.prop.popup_typeB];case i.pagetype.search:return[i.prop.popup_typeA];case i.pagetype.ranking:case i.pagetype.bookmark:return[i.prop.popup_typeB];default:return[]}}openComment(e){if(e.getURL.indexOf("mode=medium")>0){let e=$("article");e.find("[aria-expanded='false']").click(),new MutationObserver(function(t,n){e.find("[aria-expanded='false']").click()}).observe(document,{childList:!0,subtree:!0})}}setPopup(e,t){const n=new o.PopupUtil,i=(new s.ContainerFactory).setId("outerContainer").setCSS(this.outerContainerCSS).setVoidHtml().createDiv();document.body.appendChild(i),$("body").on("mouseenter",'a[href*="member_illust.php?mode=medium&illust_id="]',function(){const t=$(this).find(".non-trim-thumb"),o=t.length>0?t[0]:this;$(this).attr("onclick","console.log();return false;"),$(this).find(".non-trim-thumb").attr("onclick","console.log();return false;");const a=this,s=this.getAttribute("href").match(/(.)+illust_id=([0-9]+)(&.+)?/),r=Number(s[2]);$(o).on("click",function(t){fetch(`https://www.pixiv.net/ajax/illust/${r}`).then(function(e){return e.json()}).then(function(t){const o=new l.PixivJson(t);if(n.isManga(o)){const e=p.getPageNum(o);n.popupManga(i,a,o,Number(e))}else n.popupImg(e,i,a,o);n.popupCaption(i,o)})})});const a=()=>{const e=document.getElementById("captionContainer");null!==e&&e.parentNode.removeChild(e),i.textContent=null,i.style.display="none"};i.onmouseleave=function(){const e=document.getElementById("captionContainer").innerHTML;0==$(e).find("a").length?a():setTimeout(a(),1e3)},window.onresize=function(){i.style.maxWidth=`${.8*window.innerWidth}px`}}static getUserID(e){return e.body.tags.authorId}static getPageNum(e){return Number(e.body.pageCount)}async setConfigScreen(){const e="pixiv-view-util-icon";null===document.getElementById(e)&&(await this.setIconElem(e),await this.setModal(e))}async setIconElem(e){const t=await GM_getResourceText("gearIcon"),n=(new s.ContainerFactory).setId(e).setCSS(this.gearCSS).setInnerHtml(t).createDiv();n.className="trigger";const i=n.getElementsByTagName("svg")[0],o=n.getElementsByTagName("g")[0];i.setAttribute("width","25"),i.setAttribute("height","25"),o.setAttribute("fill","#BECAD8");const a=document.createElement("li");a.className="viewUtil",a.appendChild(n),document.body.getElementsByClassName("notifications")[0].appendChild(a)}setModal(e){const t=new a.Setting,n=document.getElementById(e),i=document.createElement("div");i.innerHTML='  \n<div id="myModal" class="pixiv-modal">\n  <div id="pixiv-modal-content" >\n    <span id="pixiv-modal-close" >OK</span>\n    <p>Setting:</p>\n    <div id="pixiv-set-IllustPageLayout">\n    Modify the illust page\'s layout\n        <input type="radio"  name=\'pixivutil-setting1\' id="pixivutil-setting1-yes" value="1"  />\n        <label for="dummy_1" data-label="ON">ON</label>\n        <input type="radio"  name=\'pixivutil-setting1\' id="pixivutil-setting1-no" value="0" checked />\n        <label for="dummy_0" data-label="OFF">OFF</label>\n    </div>\n    <div id="pixiv-set-MemberPageLayout">\n     Modify the author page\'s layout\n        <input type="radio"  name=\'pixivutil-setting2\' id="pixivutil-setting2-yes" value="1"  />\n        <label for="dummy_1" data-label="ON">ON</label>\n        <input type="radio"  name=\'pixivutil-setting2\' id="pixivutil-setting2-no" value="0" checked/>\n        <label for="dummy_0" data-label="OFF">OFF</label>\n    </div>\n    <div id="pixiv-set-Popup">\n     Use popup function\n        <input type="radio"  name=\'pixivutil-setting3\' id="pixivutil-setting3-yes" value="1" />\n        <label for="dummy_1" data-label="ON">ON</label>\n        <input type="radio"  name=\'pixivutil-setting3\' id="pixivutil-setting3-no" value="0" checked />\n        <label for="dummy_0" data-label="OFF">OFF</label>\n    </div>\n  </div>\n</div>\n\t',document.body.appendChild(i);const o=document.createElement("style");o.textContent=this.modalCSS,document.getElementsByTagName("head")[0].appendChild(o);const s=document.getElementById("myModal"),l=document.getElementById("pixiv-modal-close");n.onclick=(()=>s.style.display="block");const p=document.getElementsByName("pixivutil-setting1")[0],r=document.getElementsByName("pixivutil-setting2")[0],c=document.getElementsByName("pixivutil-setting3")[0];t.init().then(()=>{t.changeIllustPageLayout&&!p.checked&&(p.checked=!0),t.changeMemberPageLayout&&!r.checked&&(r.checked=!0),t.popup&&!c.checked&&(c.checked=!0)}),l.onclick=(()=>{s.style.display="none",t.changeIllustPageLayout=p.checked,t.changeMemberPageLayout=r.checked,t.popup=c.checked,t.save()}),window.onclick=function(e){e.target==s&&(s.style.display="none")}}}t.Util=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PixivJson=class{constructor(e){Object.assign(this,e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Manga=class{constructor(){this.followedUsersId=[],this.BOOKMARK_URL="https://www.pixiv.net/bookmark.php",this.CheckedPublic=!1,this.Checked=!1,this.artsLoaded=0,this.hits=0,this.isRunning=!1,this.lastImgId=" ",this.siteImgMaxWidth=150,this.mangaWidth=1200,this.pageNum=0,this.imgsArr=[],this.DELTASCALE="mozInnerScreenX"in window?70:4}set LastImgId(e){this.lastImgId=e}getLastImgId(){return this.lastImgId}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),o=n(0),a=n(2);t.PopupUtil=class{constructor(){this.likeIcon='<img src="https://s.pximg.net/www/js/spa/260127df5fe9ade778ec4be463deaf01.svg" width="12" height="12">',this.bookmarkIcon='<svg viewBox="0 0 12 12" width="12" height="12" class="css-1hamw6p e1rs6xf14"><path fill="currentColor" d="\n        M9,0.75 C10.6568542,0.75 12,2.09314575 12,3.75 C12,6.68851315 10.0811423,9.22726429 6.24342696,11.3662534\n        L6.24342863,11.3662564 C6.09210392,11.4505987 5.90790324,11.4505988 5.75657851,11.3662565\n        C1.9188595,9.22726671 0,6.68851455 0,3.75 C1.1324993e-16,2.09314575 1.34314575,0.75 3,0.75\n        C4.12649824,0.75 5.33911281,1.60202454 6,2.66822994 C6.66088719,1.60202454 7.87350176,0.75 9,0.75 Z"></path></svg>',this.viewIcon='<img src="https://s.pximg.net/www/js/spa/af74d092363c09fd06441a4ab04c9331.svg" width="14" height="12">',this.mangaContainerCSS="display:block;\n            background-color:black;\n            overflow-x:auto;\n            white-space:nowrap;\n            ",this.imgContainerCSS="width: auto; \n            height:auto;\n            display:block;\n            ",this.infoContainerCSS="font-size: 12px; \n            color:rgb(173, 173, 173); \n            line-height=1;"}captionContainerCSS(e){return`\n        white-space:pre-wrap;\n        display:block;\n        z-index:1001;\n        position:absolute;\n        border: 1px solid black;\n        max-width:${e.clientWidth+10}px;\n        background-color:white;\n        word-wrap:break-word;\n        word-break:break-all;\n        left:${e.style.left}px;\n        width:${e.clientWidth+10}px;\n        `}popupImg(e,t,n,i){t.textContent=null;const o=(new a.ContainerFactory).setId("popupImg").setVoidHtml().setCSS(this.imgContainerCSS).createImg();t.appendChild(o),o.src=this.getImgUrl(i),$(n).hasClass("on")?t.style.border="5px solid rgb(255, 64, 96)":t.style.border="5px solid rgb(34, 34, 34)";let s=Number(i.body.height),l=Number(i.body.width);if(s>.8*window.innerHeight||l>.8*window.innerWidth){const e=s/(.8*window.innerHeight),t=l/(.8*window.innerWidth);e>t?(s/=e,l/=e):(s/=t,l/=t)}o.style.width=`${l}px`,o.style.height=`${s}px`,t.style.width=`${l}px`,t.style.height=`${s}px`,t.style.display="block";const p=this.getOffset(t);t.style.top=p.top+"px",t.style.left=p.left+"px"}getOffset(e){const t=$(window).height(),n=$(window).width(),i=$(e).height(),o=$(e).width(),a=$(window).scrollTop()+(t-i)/2,s=(n-o)/2;return{top:Math.round(a),left:Math.round(s)}}popupCaption(e,t){const n=new a.ContainerFactory;this.deleteElementById("captionContainer");const i=t.body.description,o=n.setId("popup-caption-text").setInnerHtml(i).createDiv(),s=new Date(t.body.createDate),l=`upload:${s.getFullYear()}/${s.getMonth()+1}/${s.getDate()} ${s.getHours()}:${String(s.getMinutes()).padStart(2,"0")}`,p=n.setId("popup-caption-date").setInnerHtml(l).createDiv(),r=`${this.likeIcon} ${t.body.likeCount} `,c=n.setId("popup-caption-like").setInnerHtml(r).createSpan(),u=`${this.bookmarkIcon} ${t.body.bookmarkCount} `,d=n.setId("popup-caption-bookmark").setInnerHtml(u).createSpan(),h=`${this.viewIcon}${t.body.viewCount}`,g=n.setId("popup-caption-view").setInnerHtml(h).createSpan(),m=n.setId("popup-caption-infomation").setVoidHtml().setCSS(this.infoContainerCSS).createDiv();m.appendChild(p),m.appendChild(c),m.appendChild(d),m.appendChild(g);const y=n.setId("captionContainer").setCSS(this.captionContainerCSS(e)).setVoidHtml().createDiv();y.appendChild(o),y.appendChild(m),e.parentNode.insertBefore(y,e);const b=parseInt(e.style.top)-y.getBoundingClientRect().height;y.style.top=b+"px",y.style.left=e.style.left}deleteElementById(e){const t=document.getElementById(e);null!=t&&t.parentNode.removeChild(t)}popupManga(e,t,n,o){const s=(new a.ContainerFactory).setId("mangaContainer").setVoidHtml().setCSS(this.mangaContainerCSS).createDiv();e.appendChild(s);const l=new i.Manga;for(const t of e.children)t.style.display="none";$(t).hasClass("on")?$(e).css("background","rgb(255, 64, 96)"):$(e).css("background","rgb(34, 34, 34)"),this.imgsArrInit(e,s,l,this.getImgUrl(n),o),e.style.width=e.style.maxWidth,e.style.height=e.style.maxHeight;const p=this.getOffset(e);e.style.top=`${p.top}px`,e.style.left=`${p.left}px`,s.style.display="block",e.style.display="block",this.setScrool(e,s,l)}getImgUrl(e){return e.body.urls.regular.replace(/\/...x...\//,"/600x600/")}imgsArrInit(e,t,n,i,o){n.pageNum=o;for(let a=0;a<o;a++)n.imgsArr.push(document.createElement("img")),t.appendChild(n.imgsArr[a]),n.imgsArr[a].src=i.replace("p0","p"+a),n.imgsArr[a].style.maxWidth=e.style.maxWidth,n.imgsArr[a].style.maxHeight=e.style.maxHeight,n.imgsArr[a].style.height=e.style.maxHeight,n.imgsArr[a].style.width="auto"}setScrool(e,t,n){t.onwheel=function(i){i.deltaY<0&&e.getBoundingClientRect().top<0?e.scrollIntoView({block:"start",behavior:"smooth"}):i.deltaY>0&&e.getBoundingClientRect().bottom>document.documentElement.clientHeight&&e.scrollIntoView({block:"end",behavior:"smooth"});let o=t.scrollLeft;(o>0&&i.deltaY<0||o<t.scrollWidth-t.clientWidth&&i.deltaY>0)&&(i.preventDefault(),t.scrollLeft+=i.deltaY*n.DELTASCALE)}}getHrefElement(e,t,n){return e.pagetype===o.pagetype.member_illust?$(n).parent()[0]:$(n).parent().find("a")[0]}isManga(e){return 1===e.body.illustType||e.body.pageCount&&Number(e.body.pageCount)>1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3);t.Page=class{constructor(e){this.URL=e,this.pagetype=i.Util.checkPageType(e),this.siteImgMaxWidth=500,this.alloedFunclist=i.Util.getAllowedFuncList(this.pagetype),this.imgSelector='a[href*="member_illust.php?mode=medium&illust_id="]',this.mangaSelector='a[href*="member_illust.php?mode=medium&illust_id="] > div:nth-child(2) '}set setURL(e){this.URL=e,this.pagetype=i.Util.checkPageType(e)}get getURL(){return this.URL}get getFunclist(){return this.alloedFunclist}isEnable(e){return this.alloedFunclist.indexOf(e)>-1}get getPagetype(){return this.pagetype}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(7),o=n(3),a=n(1),s=new i.Page(document.URL),l=new o.Util,p=new a.Setting;p.init().then(()=>{l.initExecute(p,s)}),window.onload=(()=>{console.log("pagetype:"+s.pagetype.toString());l.onloadExecute(p,s);const e=document.getElementsByTagName("a");for(const t of e)t.addEventListener("click",()=>{l.onloadExecute(p,new i.Page(document.URL))});p.save()})}])}]);