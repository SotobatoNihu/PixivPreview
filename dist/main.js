!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=9)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.changeIllustPageLayout=0]="changeIllustPageLayout",e[e.changeMemberPageLayout=1]="changeMemberPageLayout",e[e.popup_typeA=2]="popup_typeA",e[e.popup_typeB=3]="popup_typeB",e[e.openComment=4]="openComment"}(t.prop||(t.prop={})),function(e){e[e.image=0]="image",e[e.manga=1]="manga",e[e.ugoira=2]="ugoira",e[e.caption=3]="caption"}(t.uiComponent||(t.uiComponent={})),function(e){e[e.top=0]="top",e[e.bookmark_new_illust=1]="bookmark_new_illust",e[e.discovery=2]="discovery",e[e.member_illust=3]="member_illust",e[e.member=4]="member",e[e.bookmark_detail=5]="bookmark_detail",e[e.bookmark_add=6]="bookmark_add",e[e.ranking=7]="ranking",e[e.bookmark_id=8]="bookmark_id",e[e.search=9]="search",e[e.bookmark=10]="bookmark",e[e.other=11]="other"}(t.pagetype||(t.pagetype={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);t.Setting=class{constructor(){this.changeIllustPageLayout=!0,this.changeMemberPageLayout=!0,this.openComment=!0,this.popup=!0,this.popupScale=.7}async init(){await GM.getValue("pixiv_viewutil_setting").then(e=>{if(void 0!==e){const t=JSON.parse(e);this.changeIllustPageLayout=null==t.changeIllustPageLayout||t.changeIllustPageLayout,this.changeMemberPageLayout=null==t.changeMemberPageLayout||t.changeMemberPageLayout,this.openComment=null==t.openComment||t.openComment,this.popup=null==t.popup||t.popup,this.popupScale=null==t.popupScale?.7:t.popupScale}})}set setStringData(e){const t=JSON.parse(e);this.changeIllustPageLayout=null==t.changeIllustPageLayout||t.changeIllustPageLayout,this.changeMemberPageLayout=null==t.changeMemberPageLayout||t.changeMemberPageLayout,this.openComment=null==t.openComment||t.openComment,this.popup=null==t.popup||t.popup,this.popupScale=null==t.popup?.7:t.popupScale,this.uiComponent=[i.uiComponent.image,i.uiComponent.manga,i.uiComponent.ugoira,i.uiComponent.caption]}set setData(e){this.changeIllustPageLayout=null==e.changeIllustPageLayout||e.changeIllustPageLayout,this.changeMemberPageLayout=null==e.changeMemberPageLayout||e.changeMemberPageLayout,this.openComment=null==e.openComment||e.openComment,this.popup=null==e.popup||e.popup,this.popupScale=null==e.popup?.7:e.popupScale}get getJsonString(){const e={changeIllustPageLayout:this.changeIllustPageLayout,changeMemberPageLayout:this.changeMemberPageLayout,openComment:this.openComment,popup:this.popup,popupScale:this.popupScale};return JSON.stringify(e)}save(){GM.setValue("pixiv_viewutil_setting",this.getJsonString)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContainerFactory=class{constructor(){this.id="",this.classname="",this.innerHtml="",this.innerText="",this.cssText=""}setId(e){return this.id=e,this}setClass(e){return this.classname=e,this}setLeft(e){}setTop(e){}setWitdh(e){return this.width=e,this}setInnerHtml(e){return this.innerHtml=e,this}setInnerText(e){return this.innerText=e,this}createDiv(){const e=document.createElement("div");return e.id=this.id,e.className=this.classname,e.innerHTML=this.innerHtml,e.style.cssText=this.cssText,this.init(),e}createImg(){const e=document.createElement("img");return e.id=this.id,e.className=this.classname,e.style.cssText=this.cssText,this.init(),e}createSpan(){const e=document.createElement("span");return e.id=this.id,e.className=this.classname,e.innerHTML=this.innerHtml,e.style.cssText=this.cssText,this.init(),e}appendChild(e){return this.appendChild(e),this}setCSS(e){return this.cssText=e,this}init(){this.id="",this.classname="",this.innerHtml="",this.innerText="",this.cssText=""}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),o=n(7),a=n(1),s=n(2),p=n(4);class r{constructor(){this.innerContainerID="popup-inner-container",this.outerContainerID="popup-outer-container",this.captionContainerID="popup-caption-container",this.popupClass="popup-util",this.outerContainerCSS=`\n        position:absolute;\n        z-index:10000;\n        background-color:#FFF;\n        border: 1px solid black;\n        max-width:${window.innerWidth}px;\n        max-height:${window.innerHeight}px;\n        `,this.captionContainerCSS=`\n        white-space:pre-wrap;\n        z-index:10001;\n        position:relative;\n       \n        width:auto;\n        height:auto;\n        max-width:${window.innerWidth}px;\n        max-height:${window.innerHeight}px;\n        background-color:white;\n        word-wrap:break-word;\n        word-break:break-all;\n        \n        `,this.gearCSS="width: 25px; \n         height: 25px;\n         color:rgb(173, 173, 173);\n         ",this.modalCSS=".pixiv-modal {\n    display: none; /* Hidden by default */\n    position: fixed; /* Stay in place */\n    z-index:10000; /* Sit on top */\n    left: 0;\n    top: 0;\n    width: 100%; /* Full width */\n    height: 100%; /* Full height */\n    overflow: auto; /* Enable scroll if needed */\n    background-color: rgb(0,0,0); /* Fallback color */\n    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */\n}\n\n/* Modal Content/Box */\n#pixiv-modal-content {\n    background-color: #fefefe;\n    margin: 15% auto; /* 15% from the top and centered */\n    padding: 20px;\n    z-index:10001;\n    border: 1px solid #888;\n    width: 80%; /* Could be more or less, depending on screen size */\n}\n\n/* The Close Button */\n#pixiv-modal-close {\n    color: #aaa;\n    float: right;\n    font-size: 28px;\n    font-weight: bold;\n}\n\n#pixiv-modal-close :hover,\n#pixiv-modal-close :focus {\n    color: black;\n    text-decoration: none;\n    cursor: pointer;\n}\n",this.pixpediaItemCSS=".popup-pixpedia-icon{\n    display: inline-block;\n    margin-left: 2px;\n    width: 15px;\n    height: 14px;\n    vertical-align: -2px;\n    text-decoration: none;\n    background: url(https://s.pximg.net/www/images/inline/pixpedia.png) no-repeat;\n    }\n.popup-pixpedia-no-icon{\n    display: inline-block;\n    margin-left: 2px;\n    width: 15px;\n    height: 14px;\n    vertical-align: -2px;\n    text-decoration: none;\n     background: url(https://s.pximg.net/www/images/inline/pixpedia-no-item.png) no-repeat;\n}\n     ",this.utilIcon="pixiv-view-util-gear"}innerContainerCSS(e){return`\n        border: 5px solid black;\n        background-color:#111;\n        position:relative;\n        width:100%;\n        height:100%;\n        float:left;\n        max-width:${window.innerWidth*e}px;\n        max-height:${window.innerHeight*e}px;\n        `}async initExecute(e,t){t.pagetype==i.pagetype.top&&null===document.getElementById(this.utilIcon)&&this.setConfigDialog(),(e.popup&&t.isEnable(i.prop.popup_typeA)||t.isEnable(i.prop.popup_typeB))&&(this.setPopup(t,e),console.log("set popup"))}onloadExecute(e,t){if(t.pagetype===i.pagetype.top&&null===document.getElementById("pixiv-view-util-gear")&&this.setConfigDialog(),e.changeIllustPageLayout&&t.isEnable(i.prop.changeIllustPageLayout)&&(r.changeIllustPageLayout(),console.log("layout chainged")),e.openComment&&t.isEnable(i.prop.openComment)&&(this.openComment(t),console.log("comment opend")),e.changeMemberPageLayout&&(t.pagetype===i.pagetype.member||t.pagetype===i.pagetype.member_illust)){this.changeMemberPageLayout();for(let e=0;e<5;e++)setTimeout(this.changeMemberPageLayout(),1e3*e)}}static checkPageType(e){return e.match("https://www.pixiv.net/bookmark_new_illust.php?")?i.pagetype.bookmark_new_illust:e.match("https://www.pixiv.net/discovery?")?i.pagetype.discovery:e.match("https://www.pixiv.net/member_illust.php?")?i.pagetype.member_illust:e.match("https://www.pixiv.net/member.php?")?i.pagetype.member:e.match("https://www.pixiv.net/bookmark_detail.php?")?i.pagetype.bookmark_detail:e.match("https://www.pixiv.net/bookmark_add.php?")?i.pagetype.bookmark_add:e.match("https://www.pixiv.net/ranking.php?")?i.pagetype.ranking:e.match(/https:\/\/www\.pixiv\.net\/bookmark\.php\?id/)?i.pagetype.bookmark_id:e.match("https://www.pixiv.net/search.php")?i.pagetype.search:e.match("https://www.pixiv.net/bookmark.php?")?i.pagetype.bookmark:e.match("https://www.pixiv.net/")?i.pagetype.top:i.pagetype.other}static changeIllustPageLayout(){$("figure").before($("figcaption"))}static getAllowedFuncList(e){switch(e){case i.pagetype.top:return[i.prop.popup_typeB];case i.pagetype.bookmark_new_illust:case i.pagetype.discovery:return[i.prop.popup_typeA];case i.pagetype.member_illust:return[i.prop.popup_typeB,i.prop.changeIllustPageLayout,i.prop.openComment];case i.pagetype.member:return[i.prop.popup_typeB,i.prop.changeMemberPageLayout];case i.pagetype.bookmark_detail:case i.pagetype.bookmark_add:case i.pagetype.bookmark_id:return[i.prop.popup_typeB];case i.pagetype.search:return[i.prop.popup_typeA];case i.pagetype.ranking:case i.pagetype.bookmark:return[i.prop.popup_typeB];default:return[]}}openComment(e){if(e.getURL.indexOf("mode=medium")>0){let e=$("article");e.find("[aria-expanded='false']").click(),new MutationObserver(function(t,n){e.find("[aria-expanded='false']").click()}).observe(document,{childList:!0,subtree:!0})}}setPopup(e,t){const n=new o.PopupUtil,i=new s.ContainerFactory,a=i.setId(this.outerContainerID).setClass(this.popupClass).setCSS(this.outerContainerCSS).createDiv(),l=i.setId(this.innerContainerID).setClass(this.popupClass).setCSS(this.innerContainerCSS(t.popupScale)).createDiv(),c=i.setId(this.captionContainerID).setClass(this.popupClass).setCSS(this.captionContainerCSS).createDiv();a.appendChild(c),a.appendChild(l),document.body.appendChild(a);const u=document.createElement("style");u.textContent=this.pixpediaItemCSS,document.getElementsByTagName("head")[0].appendChild(u);this.popupClass;$("body").on("mouseenter",'a[href*="member_illust.php?mode=medium&illust_id="]',function(){const i=$(this).find(".non-trim-thumb"),o=i.length>0?i[0]:this;$(this).attr("onclick","console.log();return false;"),$(this).find(".non-trim-thumb").attr("onclick","console.log();return false;");const s=this,l=this.getAttribute("href").match(/(.)+illust_id=([0-9]+)(&.+)?/),c=Number(l[2]);$(o).on("click",async function(i){a.style.display="block",await fetch(`https://www.pixiv.net/ajax/illust/${c}`,{method:"GET",mode:"cors",keepalive:!0}).then(function(e){if(e.ok)return e.json()}).then(async function(i){const o=new p.PixivJson(i);if(n.isManga(o)){const e=r.getPageNum(o);n.popupManga(a,s,o,Number(e))}else n.isIllust(o)?n.popupImg(e,a,s,o,t.popupScale):(n.popupImg(e,a,s,o,t.popupScale),await fetch(`https://www.pixiv.net/ajax/illust/${o.body.illustId}/ugoira_meta`).then(function(e){return e.json()}).then(e=>{n.popupUgoira(a,s,o,new p.PixivJson(e),t.popupScale).then(e=>console.log(e))}));n.popupCaption(a,o),n.adjustCaption(),n.addMouseMove(a)})})}),window.onresize=function(){a.style.maxWidth=`${window.innerWidth*t.popupScale}px`}}static getUserID(e){return e.body.tags.authorId}static getPageNum(e){return Number(e.body.pageCount)}async setConfigDialog(){const e=this.utilIcon;null===document.getElementById(this.utilIcon)&&(await this.setIconElem(e),await this.setModal(e))}async setIconElem(e){const t=await GM_getResourceText("gearIcon"),n=(new s.ContainerFactory).setId(e).setCSS(this.gearCSS).setInnerHtml(t).createDiv();n.className="trigger";const i=n.getElementsByTagName("svg")[0],o=n.getElementsByTagName("g")[0];i.setAttribute("width","25"),i.setAttribute("height","25"),o.setAttribute("fill","#BECAD8");const a=document.createElement("li");a.className="viewUtil",a.appendChild(n),document.body.getElementsByClassName("notifications")[0].appendChild(a)}setModal(e){const t=new a.Setting,n=document.getElementById(e),i=document.createElement("div");i.innerHTML='  \n<div id="myModal" class="pixiv-modal">\n  <div id="pixiv-modal-content" >\n    <span id="pixiv-modal-close" >OK</span>\n    <p>Setting:</p>\n    <div id="pixiv-set-IllustPageLayout">\n    Modify the illust page\'s layout\n        <input type="radio"  name=\'pixivutil-setting1\' id="pixivutil-setting1-yes" value="1"  />\n        <label for="dummy_1" data-label="ON">ON</label>\n        <input type="radio"  name=\'pixivutil-setting1\' id="pixivutil-setting1-no" value="0" checked />\n        <label for="dummy_0" data-label="OFF">OFF</label>\n    </div>\n    <div id="pixiv-set-MemberPageLayout">\n     Modify the author page\'s layout\n        <input type="radio"  name=\'pixivutil-setting2\' id="pixivutil-setting2-yes" value="1"  />\n        <label for="dummy_1" data-label="ON">ON</label>\n        <input type="radio"  name=\'pixivutil-setting2\' id="pixivutil-setting2-no" value="0" checked/>\n        <label for="dummy_0" data-label="OFF">OFF</label>\n    </div>\n    <div id="pixiv-set-Popup">\n     Use popup function\n        <input type="radio"  name=\'pixivutil-setting3\' id="pixivutil-setting3-yes" value="1" />\n        <label for="dummy_1" data-label="ON">ON</label>\n        <input type="radio"  name=\'pixivutil-setting3\' id="pixivutil-setting3-no" value="0" checked />\n        <label for="dummy_0" data-label="OFF">OFF</label>\n    </div>\n  </div>\n</div>\n\t',document.body.appendChild(i);const o=document.createElement("style");o.textContent=this.modalCSS,document.getElementsByTagName("head")[0].appendChild(o);const s=document.getElementById("myModal"),p=document.getElementById("pixiv-modal-close");n.onclick=(()=>s.style.display="block");const r=document.getElementsByName("pixivutil-setting1")[0],l=document.getElementsByName("pixivutil-setting2")[0],c=document.getElementsByName("pixivutil-setting3")[0];t.init().then(()=>{t.changeIllustPageLayout&&!r.checked&&(r.checked=!0),t.changeMemberPageLayout&&!l.checked&&(l.checked=!0),t.popup&&!c.checked&&(c.checked=!0)}),p.onclick=(()=>{s.style.display="none",t.changeIllustPageLayout=r.checked,t.changeMemberPageLayout=l.checked,t.popup=c.checked,t.save()}),window.onclick=function(e){e.target==s&&(s.style.display="none")}}changeMemberPageLayout(){const e=document.getElementsByTagName("h2");if(void 0!==e)for(const t of e)if(t.innerText.startsWith("イラスト")){const e=t.parentElement.parentElement,n=document.getElementsByTagName("header")[0];n.parentNode.insertBefore(e,n.nextSibling);break}}}t.Util=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PixivJson=class{constructor(e){Object.assign(this,e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Ugoira=class{constructor(){this.imgArray=[],this.imgStringArray=[],this.frameArray=[]}pushImgElem(e){this.imgArray.push(e)}pushImgString(e){this.imgStringArray.push(e)}pushFrame(e){this.frameArray.push(e)}get getImgArray(){return this.imgArray}get getImgStringArray(){return this.imgStringArray}get getFrameArray(){return this.frameArray}get getFrameNum(){return this.imgArray.length}get getIntervalSum(){return this.frameArray.length>1?this.frameArray.reduce((e,t)=>e+t):0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Manga=class{constructor(){this.followedUsersId=[],this.BOOKMARK_URL="https://www.pixiv.net/bookmark.php",this.CheckedPublic=!1,this.Checked=!1,this.artsLoaded=0,this.hits=0,this.isRunning=!1,this.lastImgId=" ",this.siteImgMaxWidth=150,this.mangaWidth=1200,this.pageNum=0,this.imgsArr=[],this.DELTASCALE="mozInnerScreenX"in window?70:4}set LastImgId(e){this.lastImgId=e}getLastImgId(){return this.lastImgId}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(6),o=n(0),a=n(2),s=n(5);t.PopupUtil=class{constructor(){this.likeIcon='<img src="https://s.pximg.net/www/js/spa/260127df5fe9ade778ec4be463deaf01.svg" width="12" height="12">',this.bookmarkIcon='<svg viewBox="0 0 12 12" width="12" height="12" class="css-1hamw6p e1rs6xf14"><path fill="currentColor" d="\n        M9,0.75 C10.6568542,0.75 12,2.09314575 12,3.75 C12,6.68851315 10.0811423,9.22726429 6.24342696,11.3662534\n        L6.24342863,11.3662564 C6.09210392,11.4505987 5.90790324,11.4505988 5.75657851,11.3662565\n        C1.9188595,9.22726671 0,6.68851455 0,3.75 C1.1324993e-16,2.09314575 1.34314575,0.75 3,0.75\n        C4.12649824,0.75 5.33911281,1.60202454 6,2.66822994 C6.66088719,1.60202454 7.87350176,0.75 9,0.75 Z"></path></svg>',this.viewIcon='<img src="https://s.pximg.net/www/js/spa/af74d092363c09fd06441a4ab04c9331.svg" width="14" height="12">',this.innerContainerID="popup-inner-container",this.outerContainerID="popup-outer-container",this.imgContainerID="popup-img",this.mangaContainerID="popup-manga",this.ugoiraContainerID="popup-ugoira",this.captionContainerID="popup-caption-container",this.captionDescriptionID="popup-caption-text",this.captionTagID="popup-caption-tag",this.captionDateID="popup-caption-date",this.captionLikeID="popup-caption-like",this.captionBookmarkID="popup-caption-bookmark",this.captionViewID="popup-caption-view",this.captionInfoID="popup-caption-infomation",this.popupClass="popup-util",this.mangaContainerCSS=" background-color:black;\n           overflow-x:auto;\n           white-space:nowrap;\n           width: auto; \n           height:auto;\n           left: 0;\n           top: 0;\n            ",this.infoContainerCSS="\n        background-color:white;\n        font-size:xx-small;\n        width: auto;\n        color:rgb(173, 173, 173); \n        line-height=1;",this.imgContainerCSS="width: 100%; \n          height:100%;\n          left: 0;\n          top: 0;\n          background-size: contain;\n          background-position:center; \n          background-repeat:no-repeat;\n            ",this.descriptionContainerCSS="font-size: normal; \n          width: auto; \n          height:auto;\n          overflow-y:scroll;"}pixpediaCSS(e){return`\n        white-space:pre-wrap;\n        font-size:small; \n        z-index:10001;\n        position:relative;\n        border: 1px solid black;\n        max-width:${e.clientWidth+10}px;\n        background-color:white;\n        word-wrap:break-word;\n        word-break:break-all;\n        left:auto;\n        width:auto;\n        `}popupImg(e,t,n,i,o){const s=document.getElementById(this.innerContainerID);s.innerHTML="";const p=(new a.ContainerFactory).setId(this.imgContainerID).setClass(this.popupClass).setCSS(this.imgContainerCSS).createDiv();s.appendChild(p),p.style.backgroundImage=`url(${i.body.urls.regular})`,$(n).hasClass("on")?s.style.border="5px solid rgb(255, 64, 96)":s.style.border="5px solid rgb(34, 34, 34)";const r=this.resize(i.body.width,i.body.height,o);let l=r.height,c=r.width;t.style.width=`${c}px`,t.style.height=`${l}px`}getOffset(e){const t=$(window).height(),n=$(window).width(),i=$(e).height(),o=$(e).width(),a=$(window).scrollTop()+(t-i)/2,s=(n-o)/2;return{top:Math.round(a),left:Math.round(s)}}popupCaption(e,t){const n=document.getElementById(this.captionContainerID);document.getElementById(this.innerContainerID),n.innerText="";const i=new a.ContainerFactory,o=i.setId(this.captionDescriptionID).setClass(this.popupClass).setCSS(this.descriptionContainerCSS).setInnerHtml(t.body.description).createDiv(),s=i.setId(this.captionTagID).setClass(this.popupClass).createDiv();s.appendChild(this.getTagHtml(t));const p=new Date(t.body.createDate),r=`upload:${p.getFullYear()}/${p.getMonth()+1}/${p.getDate()} ${p.getHours()}:${String(p.getMinutes()).padStart(2,"0")}`,l=i.setId(this.captionDateID).setInnerHtml(r).createDiv(),c=`${this.likeIcon} ${t.body.likeCount} `,u=i.setId(this.captionLikeID).setClass(this.popupClass).setInnerHtml(c).createSpan(),h=`${this.bookmarkIcon} ${t.body.bookmarkCount} `,d=i.setId(this.captionBookmarkID).setClass(this.popupClass).setInnerHtml(h).createSpan(),g=`${this.viewIcon}${t.body.viewCount}`,m=i.setId(this.captionViewID).setClass(this.popupClass).setInnerHtml(g).createSpan(),y=i.setId(this.captionInfoID).setClass(this.popupClass).setCSS(this.infoContainerCSS).createDiv();y.appendChild(l),y.appendChild(u),y.appendChild(d),y.appendChild(m),n.appendChild(o),n.appendChild(s),n.appendChild(y)}getTagHtml(e){let t=document.createElement("ul");t.style.paddingInlineStart="0px";for(const n of e.body.tags.tags){let e=document.createElement("a");e.className=`${n.romaji||n.locked?"popup-pixpedia-icon":"popup-pixpedia-no-icon"}`,e.setAttribute("href",`https://dic.pixiv.net/a/${n.tag}`);let i=document.createElement("li");i.innerHTML=` ${n.locked?"<span>＊<span>":""}${n.tag}`,i.style.cssText="display: inline-block;",i.appendChild(e),t.appendChild(i)}return t}popupManga(e,t,n,o){const s=document.getElementById(this.innerContainerID);s.innerHTML="";const p=(new a.ContainerFactory).setId(this.mangaContainerID).setClass(this.popupClass).setCSS(this.mangaContainerCSS).createDiv();s.appendChild(p);const r=new i.Manga;$(t).hasClass("on")?$(s).css("background","rgb(255, 64, 96)"):$(s).css("background","rgb(34, 34, 34)"),this.imgsArrInit(s,p,r,this.getImgUrl(n),o),e.style.width=s.style.maxWidth,e.style.height=s.style.maxHeight,this.setScrool(s,p,r)}getImgUrl(e){return e.body.urls.regular.replace(/\/...x...\//,"/600x600/")}imgsArrInit(e,t,n,i,o){n.pageNum=o;for(let a=0;a<o;a++)n.imgsArr.push(document.createElement("img")),t.appendChild(n.imgsArr[a]),n.imgsArr[a].src=i.replace("p0","p"+a),n.imgsArr[a].style.maxWidth=e.style.maxWidth,n.imgsArr[a].style.maxHeight=e.style.maxHeight,n.imgsArr[a].style.height=e.style.maxHeight,n.imgsArr[a].style.width="auto"}setScrool(e,t,n){t.onwheel=function(i){i.deltaY<0&&e.getBoundingClientRect().top<0?e.scrollIntoView({block:"start",behavior:"smooth"}):i.deltaY>0&&e.getBoundingClientRect().bottom>document.documentElement.clientHeight&&e.scrollIntoView({block:"end",behavior:"smooth"});let o=t.scrollLeft;(o>0&&i.deltaY<0||o<t.scrollWidth-t.clientWidth&&i.deltaY>0)&&(i.preventDefault(),t.scrollLeft+=i.deltaY*n.DELTASCALE)}}getHrefElement(e,t,n){return e.pagetype===o.pagetype.member_illust?$(n).parent()[0]:$(n).parent().find("a")[0]}async popupUgoira(e,t,n,i,o){const p=document.getElementById(this.innerContainerID);p.innerHTML="";let r=!1;const l=new a.ContainerFactory;p.textContent=null;const c=l.setId(this.ugoiraContainerID).setClass(this.popupClass).createDiv();p.appendChild(c);let u=new Headers;u.append("Accept-Encoding","gzip, deflate, br"),u.append("Connection","keep-alive"),u.append("HOST","www.pixiv.net");let h=new JSZip;const d=new s.Ugoira,g=i.body.frames;await fetch(i.body.src,{method:"GET",headers:u,mode:"cors",keepalive:!0}).then(e=>{if(e.ok)return e.blob()}).then(async e=>{await h.loadAsync(e,{base64:!0})}).then(async()=>{for(let e of g)d.pushFrame(e.delay),await h.file(e.file).async("base64",function(e){console.log("progression: "+e.percent.toFixed(2)+" %"),100===e.percent&&(r=!0)}).then(function(e){d.pushImgString(`data:image/jpeg;base64,${e}`)},function(e){console.log("download error.")})}).then(()=>{const t=document.createElement("canvas"),i=this.resize(n.body.width,n.body.height,o);t.width=i.width,t.height=i.height,e.style.width=`${i.width}px`,e.style.height=`${i.height}px`,p.style.width=`${i.width}px`,p.style.height=`${i.height}px`,c.appendChild(t),$(p).css("background","rgb(34, 34, 34)");const a=d.getFrameArray,s=d.getImgStringArray;let r=0;const l=()=>{r=(r+=1)===s.length?0:r;const e=new Image;e.src=s[r],t.getContext("2d").drawImage(e,0,0,t.clientWidth,t.clientHeight),setTimeout(l,a[r])};l()})}isIllust(e){return 0===e.body.illustType}isManga(e){return 1===e.body.illustType||e.body.pageCount&&Number(e.body.pageCount)>1}isUgoira(e){return 2===e.body.illustType}resize(e,t,n){let i=t,o=e;if(t>window.innerHeight*n||e>window.innerWidth*n){const a=t/Number(window.innerHeight*n),s=e/Number(window.innerWidth*n);a>s?(i/=a,o/=a):(i/=s,o/=s)}return{width:Math.round(o),height:Math.round(i)}}addMouseMove(e){let t=0,n=0,i=0,o=0,a=!1;const s=s=>{a=!0,(s=s||window.event).preventDefault(),t=i-s.clientX,n=o-s.clientY,i=s.clientX,o=s.clientY,e.style.top=e.offsetTop-n+"px",e.style.left=e.offsetLeft-t+"px"},p=()=>{document.onmouseup=null,document.onmousemove=null,a||this.cleanContainer(e),a=!1};e.onmousedown=(e=>{(e=e||window.event).preventDefault(),i=e.clientX,o=e.clientY,document.onmouseup=p,document.onmousemove=s}),e.onmouseleave=(()=>{this.cleanContainer(e)})}cleanContainer(e){const t=document.getElementById(this.innerContainerID),n=document.getElementById(this.captionContainerID);t.innerText="",n.innerText="",e.style.display="none"}adjustCaption(){document.getElementById(this.innerContainerID);const e=document.getElementById(this.outerContainerID),t=document.getElementById(this.captionContainerID),n=document.getElementById(this.captionDescriptionID);document.getElementById(this.captionTagID),document.getElementById(this.captionInfoID),n.clientHeight>100&&(n.style.height="100px");const i=this.getOffset(e);e.style.left=`${i.left}px`,e.style.top=`${i.top}px`,t.style.width=`${e.offsetWidth+10}px`}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3);t.Page=class{constructor(e){this.URL=e,this.pagetype=i.Util.checkPageType(e),this.siteImgMaxWidth=500,this.alloedFunclist=i.Util.getAllowedFuncList(this.pagetype),this.imgSelector='a[href*="member_illust.php?mode=medium&illust_id="]',this.mangaSelector='a[href*="member_illust.php?mode=medium&illust_id="] > div:nth-child(2) '}set setURL(e){this.URL=e,this.pagetype=i.Util.checkPageType(e)}get getURL(){return this.URL}get getFunclist(){return this.alloedFunclist}isEnable(e){return this.alloedFunclist.indexOf(e)>-1}get getPagetype(){return this.pagetype}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(8),o=n(3),a=n(1),s=new i.Page(document.URL),p=new o.Util,r=new a.Setting;r.init().then(()=>{p.initExecute(r,s)}),window.onload=(()=>{console.log("pagetype:"+s.pagetype.toString()),p.onloadExecute(r,s);const e=document.getElementsByTagName("a");for(const t of e)t.addEventListener("click",()=>{p.onloadExecute(r,new i.Page(document.URL))});r.save()})}])}]);